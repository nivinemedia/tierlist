<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Naruto Cl√°ssico ‚Äì Tier List</title>
<link href="https://fonts.googleapis.com/css2?family=Teko:wght@600;700&family=Nunito:wght@400;600;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --orange: #FF6B00;
    --orange-dark: #CC5500;
    --orange-light: #FF9A3C;
    --bg: #0F0F0F;
    --bg2: #1A1A1A;
    --bg3: #222222;
    --border: #333;
    --text: #E8E8E8;
    --text-muted: #888;
    --s: #FF4444;
    --a: #FF8C00;
    --b: #FFD700;
    --c: #44CC44;
    --d: #4488FF;
    --f: #AA44FF;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  html, body {
    height: 100%;
    overflow: hidden;
  }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Nunito', sans-serif;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* Header */
  .header {
    background: linear-gradient(180deg, #1A0A00 0%, #0F0800 100%);
    border-bottom: 3px solid var(--orange);
    padding: 14px 20px;
    text-align: center;
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
  }
  .header::before {
    content: '';
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(45deg, transparent, transparent 20px, rgba(255,107,0,0.03) 20px, rgba(255,107,0,0.03) 40px);
  }
  .header h1 {
    font-family: 'Teko', sans-serif;
    font-size: clamp(2.4rem, 5.5vw, 4.2rem);
    color: var(--orange);
    letter-spacing: 6px;
    text-shadow: 3px 3px 0 rgba(0,0,0,0.8), 0 0 30px rgba(255,107,0,0.4);
    position: relative;
  }
  .header p {
    font-size: 0.75rem;
    color: var(--text-muted);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-top: 6px;
    position: relative;
  }

  /* Layout */
  .layout {
    display: flex;
    flex: 1;
    min-height: 0;
    overflow: hidden;
  }

  /* Sidebar */
  .sidebar {
    width: 220px;
    min-width: 220px;
    background: var(--bg2);
    border-right: 2px solid var(--border);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    height: 100%;
  }
  .sidebar-filters {
    display: flex;
    gap: 6px;
    padding: 10px;
    background: var(--bg3);
    border-bottom: 1px solid var(--border);
  }
  .filter-btn {
    flex: 1;
    padding: 5px 8px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text-muted);
    border-radius: 4px;
    cursor: pointer;
    font-family: 'Nunito', sans-serif;
    font-weight: 700;
    font-size: 0.75rem;
    transition: all 0.2s;
    text-transform: uppercase;
  }
  .filter-btn.active, .filter-btn:hover {
    background: var(--orange);
    color: #000;
    border-color: var(--orange);
  }
  .sidebar-list {
    overflow-y: auto;
    flex: 1;
    padding: 6px;
    scrollbar-width: thin;
    scrollbar-color: var(--orange) var(--bg3);
  }

  /* Music Card */
  .music-card {
    background: var(--bg3);
    border: 1px solid var(--border);
    border-radius: 8px;
    margin-bottom: 6px;
    cursor: grab;
    transition: all 0.2s;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    user-select: none;
  }
  .music-card:hover { border-color: var(--orange); transform: translateX(2px); }
  .music-card.dragging { opacity: 0.4; cursor: grabbing; }
  .card-thumb {
    position: relative;
    width: 100%;
    aspect-ratio: 16/9;
    background: linear-gradient(135deg, #1A0A00, #2A1500);
    overflow: hidden;
  }
  .card-thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
  .card-thumb-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Teko', sans-serif;
    font-size: 2.5rem;
    color: rgba(255,107,0,0.3);
    background: linear-gradient(135deg, #1A0800, #0A0400);
  }
  .card-badge {
    position: absolute;
    top: 5px;
    left: 5px;
    background: var(--orange);
    color: #000;
    font-size: 0.6rem;
    font-weight: 900;
    padding: 2px 5px;
    border-radius: 3px;
    font-family: 'Nunito', sans-serif;
    letter-spacing: 0.5px;
  }
  .card-badge.ed { background: #4488FF; color: #fff; }
  .card-yt {
    position: absolute;
    bottom: 5px;
    right: 5px;
    background: #FF0000;
    color: #fff;
    font-size: 0.55rem;
    font-weight: 700;
    padding: 2px 5px;
    border-radius: 3px;
    text-decoration: none;
    opacity: 0.9;
    transition: opacity 0.2s;
    z-index: 2;
  }
  .card-yt:hover { opacity: 1; }
  .card-info {
    padding: 6px 8px;
  }
  .card-title {
    font-size: 0.72rem;
    font-weight: 700;
    color: var(--text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.3;
  }
  .card-artist {
    font-size: 0.63rem;
    color: var(--text-muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-top: 1px;
  }

  /* Tier Area */
  .tier-area {
    flex: 1;
    overflow-y: auto;
    padding: 10px 14px;
    scrollbar-width: thin;
    scrollbar-color: var(--orange) var(--bg);
    min-height: 0;
  }

  /* Tier Row */
  .tier-row {
    display: flex;
    align-items: stretch;
    margin-bottom: 6px;
    border: 1px solid var(--border);
    border-radius: 4px;
    overflow: hidden;
    min-height: 80px;
    background: var(--bg2);
    transition: border-color 0.2s;
  }
  .tier-row.drag-over { border-color: var(--orange); background: rgba(255,107,0,0.05); }
  .tier-label {
    width: var(--tier-label-width, 90px);
    min-width: 90px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-family: 'Teko', sans-serif;
    font-size: 1.8rem;
    letter-spacing: 1px;
    color: #000;
    text-shadow: 1px 1px 0 rgba(0,0,0,0.3);
    cursor: pointer;
    transition: filter 0.2s;
    padding: 8px 10px;
    word-break: break-word;
    line-height: 1.2;
    flex-shrink: 0;
    overflow: hidden;
  }
  .tier-label:hover { filter: brightness(1.15); }
  .tier-edit-popup {
    position: fixed;
    background: #1E1E1E;
    border: 1px solid #FF6B00;
    border-radius: 8px;
    padding: 12px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 8px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.6);
    min-width: 180px;
  }
  .tier-edit-popup input[type="text"] {
    background: #111;
    border: 1px solid #444;
    color: #fff;
    padding: 6px 8px;
    border-radius: 4px;
    font-family: 'Teko', sans-serif;
    font-size: 1.2rem;
    letter-spacing: 1px;
    width: 100%;
    outline: none;
  }
  .tier-edit-popup input[type="text"]:focus { border-color: #FF6B00; }
  .tier-edit-popup input[type="color"] { display:none; }
  .color-picker-wrap { position:relative; width:100%; }
  .color-spectrum {
    width: 100%;
    height: 140px;
    border-radius: 4px;
    cursor: crosshair;
    display: block;
  }
  .color-hue-slider {
    width: 100%;
    height: 14px;
    border-radius: 4px;
    cursor: pointer;
    display: block;
    margin-top: 6px;
    outline: none;
    -webkit-appearance: none;
    background: linear-gradient(to right,#f00,#ff0,#0f0,#0ff,#00f,#f0f,#f00);
  }
  .color-hue-slider::-webkit-slider-thumb {
    -webkit-appearance:none; width:14px; height:14px; border-radius:50%;
    background:#fff; border:2px solid #888; cursor:pointer;
  }
  .color-preview-row { display:flex; align-items:center; gap:8px; margin-top:6px; }
  .color-preview-swatch {
    width:28px; height:28px; border-radius:4px; border:1px solid #555; flex-shrink:0;
  }
  .color-preview-hex {
    flex:1; background:#111; border:1px solid #444; color:#fff;
    padding:4px 6px; border-radius:4px; font-family:monospace; font-size:0.85rem;
    letter-spacing:1px; outline:none;
  }
  .color-preview-hex:focus { border-color:#FF6B00; }
  .tier-edit-popup label {
    font-size: 0.65rem;
    color: #888;
    letter-spacing: 1px;
    text-transform: uppercase;
    font-family: 'Nunito', sans-serif;
  }
  .tier-edit-popup .popup-confirm {
    background: #FF6B00;
    border: none;
    color: #000;
    padding: 6px;
    border-radius: 4px;
    cursor: pointer;
    font-family: 'Nunito', sans-serif;
    font-weight: 700;
    font-size: 0.8rem;
  }
  .tier-content {
    flex: 1;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 5px;
    padding: 6px 10px;
    min-height: 80px;
  }
  .tier-placeholder {
    color: var(--border);
    font-size: 0.75rem;
    font-style: italic;
    letter-spacing: 1px;
    pointer-events: none;
  }
  .tier-controls {
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 4px;
    gap: 2px;
    opacity: 0;
    transition: opacity 0.2s;
  }
  .tier-row:hover .tier-controls { opacity: 1; }
  .tier-btn {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--text-muted);
    width: 22px;
    height: 22px;
    border-radius: 3px;
    cursor: pointer;
    font-size: 0.65rem;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .tier-btn:hover { border-color: var(--orange); color: var(--orange); }
  .tier-btn.remove:hover { border-color: #FF4444; color: #FF4444; }

  /* Tier mini cards (dropped) */
  .tier-item {
    width: 68px;
    height: 48px;
    border-radius: 4px;
    overflow: hidden;
    position: relative;
    cursor: grab;
    border: 1px solid var(--border);
    transition: all 0.15s;
    flex-shrink: 0;
  }
  .tier-item:hover { transform: scale(1.05); border-color: #fff; z-index: 2; }
  .tier-item.dragging { opacity: 0.3; }
  .tier-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    pointer-events: none;
  }
  .tier-item-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.6rem;
    font-weight: 700;
    color: rgba(255,255,255,0.7);
    text-align: center;
    padding: 2px;
    background: linear-gradient(135deg, #1a0800, #0a0400);
    pointer-events: none;
  }
  .tier-item-badge {
    position: absolute;
    top: 3px;
    left: 3px;
    background: #FF6B00;
    color: #000;
    font-size: 0.52rem;
    font-weight: 900;
    padding: 1px 4px;
    border-radius: 3px;
    font-family: 'Nunito', sans-serif;
    letter-spacing: 0.3px;
    pointer-events: none;
    z-index: 3;
    white-space: nowrap;
  }
  .tier-item-badge.ed { background: #4488FF; color: #fff; }
  .tier-item-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    color: rgba(255,255,255,0.95);
    background: rgba(0,0,0,0.45);
    opacity: 0;
    transition: opacity 0.15s;
    cursor: pointer;
    z-index: 4;
  }
  .tier-item:hover .tier-item-overlay { opacity: 1; }
  .tier-item-remove {
    position: absolute;
    top: 3px;
    right: 3px;
    background: rgba(0,0,0,0.75);
    border: 1px solid rgba(255,255,255,0.3);
    color: #fff;
    font-size: 0.6rem;
    width: 16px;
    height: 16px;
    border-radius: 3px;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.15s;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 5;
    padding: 0;
  }
  .tier-item:hover .tier-item-remove { opacity: 1; }
  .tier-item-remove:hover { background: #FF4444; border-color: #FF4444; }
  .tier-item-tooltip {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.95);
    color: #fff;
    font-size: 0.65rem;
    padding: 4px 7px;
    border-radius: 4px;
    white-space: nowrap;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 100;
    border: 1px solid var(--orange);
    margin-bottom: 4px;
  }
  .tier-item:hover .tier-item-tooltip { opacity: 1; }

  /* Bottom Bar */
  .bottom-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 14px;
    background: var(--bg2);
    border-top: 2px solid var(--border);
    gap: 10px;
  }
  .add-tier-btn {
    flex: 1;
    background: transparent;
    border: 2px dashed var(--orange-dark);
    color: var(--orange);
    padding: 10px;
    border-radius: 6px;
    cursor: pointer;
    font-family: 'Nunito', sans-serif;
    font-weight: 700;
    font-size: 0.85rem;
    transition: all 0.2s;
    letter-spacing: 1px;
  }
  .add-tier-btn:hover { background: rgba(255,107,0,0.1); border-style: solid; }
  .action-btn {
    padding: 10px 18px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-family: 'Nunito', sans-serif;
    font-weight: 800;
    font-size: 0.85rem;
    transition: all 0.2s;
    letter-spacing: 0.5px;
  }
  .btn-reset { background: var(--bg3); color: var(--text-muted); border: 1px solid var(--border); }
  .btn-reset:hover { border-color: var(--text-muted); color: var(--text); }
  .btn-result { background: var(--orange); color: #000; }
  .btn-result:hover { background: var(--orange-light); transform: translateY(-1px); box-shadow: 0 4px 15px rgba(255,107,0,0.4); }

  /* Modal */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.85);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    backdrop-filter: blur(4px);
    overflow-y: auto;
  }
  .modal { 
    background: var(--bg2);
    border: 2px solid var(--orange);
    border-radius: 12px;
    padding: 24px;
    max-width: 720px;
    width: 100%;
    max-height: 85vh;
    overflow-y: auto;
    margin: auto;
    position: relative;
  }
  .modal h2 {
    font-family: 'Teko', sans-serif;
    font-size: 1.8rem;
    color: var(--orange);
    letter-spacing: 3px;
    margin-bottom: 20px;
    text-align: center;
  }
  .modal-tier {
    margin-bottom: 14px;
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid var(--border);
  }
  .modal-tier-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px 14px;
    font-weight: 700;
    font-size: 1rem;
    color: #000;
  }
  .modal-tier-label {
    font-family: 'Teko', sans-serif;
    font-size: 1.6rem;
    letter-spacing: 2px;
  }
  .modal-tier-songs {
    padding: 10px 14px;
    background: var(--bg3);
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }
  .modal-song-chip {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 4px 12px;
    font-size: 0.8rem;
    color: var(--text);
    font-weight: 600;
  }
  .modal-tier-songs {
    padding: 10px 14px;
    background: var(--bg3);
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }
  .modal-song-card {
    width: 86px;
    border-radius: 6px;
    overflow: hidden;
    border: 1px solid var(--border);
    cursor: pointer;
    transition: transform 0.15s, border-color 0.15s;
    background: var(--bg2);
    flex-shrink: 0;
  }
  .modal-song-card:hover { transform: scale(1.06); border-color: var(--orange); }
  .modal-song-thumb {
    width: 100%;
    height: 54px;
    overflow: hidden;
    background: #111;
  }
  .modal-song-name {
    font-size: 0.6rem;
    font-weight: 700;
    color: var(--text);
    padding: 4px 5px;
    text-align: center;
    line-height: 1.3;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .modal-empty { color: var(--text-muted); font-style: italic; font-size: 0.8rem; }
  .modal-close {
    position: absolute;
    top: 12px;
    right: 14px;
    background: transparent;
    border: 1px solid var(--border);
    color: var(--text-muted);
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1rem;
    transition: all 0.2s;
  }
  .modal-close:hover { border-color: #FF4444; color: #FF4444; }
  .modal-share-btn {
    display: block;
    width: 100%;
    margin-top: 16px;
    padding: 12px;
    background: var(--orange);
    color: #000;
    border: none;
    border-radius: 8px;
    font-family: 'Nunito', sans-serif;
    font-weight: 800;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
  }
  .modal-share-btn:hover { background: var(--orange-light); }


  .card-thumb-actions {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    background: rgba(0,0,0,0.45);
    opacity: 0;
    transition: opacity 0.2s;
  }
  .card-thumb:hover .card-thumb-actions { opacity: 1; }
  .card-play-btn {
    background: rgba(0,0,0,0.7);
    border: 1px solid rgba(255,255,255,0.5);
    color: #fff;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
  }
  .card-play-btn:hover { background: #FF6B00; border-color: #FF6B00; color: #000; }
  .card-yt-btn {
    background: #FF0000;
    border: none;
    color: #fff;
    padding: 4px 7px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.6rem;
    font-weight: 700;
    font-family: 'Nunito', sans-serif;
    transition: opacity 0.15s;
  }
  .card-yt-btn:hover { opacity: 0.85; }
  /* hidden */
  .hidden { display: none !important; }

  /* ‚îÄ‚îÄ YouTube Popup ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  #ytPopupOverlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    z-index: 9999;
    align-items: center;
    justify-content: center;
  }
  #ytPopupOverlay.active { display: flex; }
  #ytPopupBox {
    position: relative;
    background: #111;
    border: 2px solid #FF6B00;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 8px 40px rgba(0,0,0,0.8);
    width: 1100px;
    max-width: 92vw;
  }
  #ytPopupBox iframe {
    display: block;
    width: 100%;
    aspect-ratio: 16/9;
    border: none;
  }
  #ytPopupClose {
    position: absolute;
    top: 8px;
    right: 10px;
    background: rgba(0,0,0,0.7);
    border: none;
    color: #fff;
    font-size: 1.2rem;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1;
    transition: background 0.2s;
  }
  #ytPopupClose:hover { background: #FF6B00; color: #000; }
</style>
</head>
<body>

<div class="header">
  <h1>NARUTO ‚Äì TIERLIST</h1>
  <p>Arraste as m√∫sicas para a tier ‚Ä¢ Passe o mouse para ver o nome ‚Ä¢ Clique em ‚ñ∂ para ouvir no YouTube</p>
</div>



<!-- Nav Tabs -->
<div style="display:flex;gap:0;background:#0F0F0F;border-bottom:1px solid #222;flex-shrink:0;">
  <button id="tabMusicas" onclick="switchTab('musicas')" style="padding:8px 24px;border:none;border-bottom:3px solid #FF6B00;background:transparent;color:#FF6B00;font-family:'Teko',sans-serif;font-size:1.05rem;letter-spacing:2px;cursor:pointer;transition:all 0.2s;text-transform:uppercase;">OP/ED Cl√°ssico</button>
  <button id="tabPersonagens" onclick="switchTab('personagens')" style="padding:8px 24px;border:none;border-bottom:3px solid transparent;background:transparent;color:#444;font-family:'Teko',sans-serif;font-size:1.05rem;letter-spacing:2px;cursor:pointer;transition:all 0.2s;text-transform:uppercase;">Pers. Cl√°ssico</button>
</div>

<!-- Main content + chat wrapper -->
<div style="display:flex;flex:1;overflow:hidden;min-height:0;">

<!-- Tier content -->
<div style="flex:1;display:flex;flex-direction:column;overflow:hidden;min-height:0;">
<div id="layoutMusicas" class="layout">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-filters">
      <button class="filter-btn active" onclick="filterCards('all', this)">ALL</button>
      <button class="filter-btn" onclick="filterCards('op', this)">OP</button>
      <button class="filter-btn" onclick="filterCards('ed', this)">ED</button>
    </div>
    <div class="sidebar-list" id="sidebarList"></div>
  </div>

  <!-- Right Panel -->
  <div style="flex:1; display:flex; flex-direction:column; overflow:hidden; min-height:0; height:100%; padding-bottom:0;" id="rightPanel">
    <div class="tier-area" id="tierArea"></div>
    <div id="audioBar" style="display:none;background:#1A0800;border-top:2px solid #FF6B00;padding:8px 16px;align-items:center;gap:10px;flex-shrink:0;">
      <div id="audioThumb" style="width:48px;height:34px;border-radius:4px;overflow:hidden;flex-shrink:0;background:#111;"></div>
      <div style="flex:1;min-width:0;">
        <div id="audioTitle" style="font-size:0.75rem;font-weight:700;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"></div>
        <div id="audioArtist" style="font-size:0.65rem;color:#888;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"></div>
      </div>
      <button id="audioPrev" onclick="audioSkip(-1)" style="background:transparent;border:1px solid #444;color:#ccc;width:30px;height:30px;border-radius:50%;cursor:pointer;font-size:0.8rem;" title="Anterior">‚èÆ</button>
      <button id="audioPlayPause" onclick="audioToggle()" style="background:#FF6B00;border:none;color:#000;width:36px;height:36px;border-radius:50%;cursor:pointer;font-size:1rem;font-weight:bold;">‚ñ∂</button>
      <button id="audioNext" onclick="audioSkip(1)" style="background:transparent;border:1px solid #444;color:#ccc;width:30px;height:30px;border-radius:50%;cursor:pointer;font-size:0.8rem;" title="Pr√≥ximo">‚è≠</button>
      <input type="range" id="audioVol" min="0" max="100" value="80" oninput="audioSetVol(this.value)" style="width:70px;accent-color:#FF6B00;" title="Volume">
      <button onclick="audioStop()" style="background:transparent;border:1px solid #444;color:#888;width:30px;height:30px;border-radius:50%;cursor:pointer;font-size:0.75rem;" title="Fechar">‚úï</button>
    </div>
    <div class="bottom-bar">
      <div style="display:flex;flex-direction:column;flex:1;gap:6px;">
        <button class="add-tier-btn" onclick="addTier()" style="width:100%;">+ Adicionar Tier</button>
        <a href="https://x.com/nivinemedia" target="_blank" style="display:block;text-align:center;color:#555;font-size:0.65rem;letter-spacing:2px;font-family:'Nunito',sans-serif;text-decoration:none;transition:color 0.2s;" onmouseover="this.style.color='#FF6B00'" onmouseout="this.style.color='#555'">feito por @nivinemedia</a>
      </div>
      <button class="action-btn btn-reset" onclick="resetAll()">‚Ü∫ Resetar</button>
      <button class="action-btn btn-result" onclick="takeScreenshot()">üì∏ Tirar Print</button>
      <button class="action-btn btn-result" onclick="showSplit()" style="background:linear-gradient(135deg,#1a1a2e,#16213e);border-color:#6C63FF;color:#6C63FF;">‚ö° Separar OP/ED</button>
    </div>
  </div>
</div><!-- end layoutMusicas -->

<!-- Layout Personagens -->
<div id="layoutPersonagens" style="display:none;flex:1;flex-direction:row;overflow:hidden;min-height:0;">
  <!-- Left sidebar: 3-column grid of character photos -->
  <div id="sidebarPersonagens" style="width:220px;flex-shrink:0;background:#111;border-right:2px solid #2A2A2A;padding:8px;display:grid;grid-template-columns:repeat(3,1fr);gap:5px;align-content:start;overflow-y:auto;overflow-x:hidden;scrollbar-width:thin;scrollbar-color:#FF6B00 #1A1A1A;"></div>
  <!-- Right: tiers + bottom bar -->
  <div style="flex:1;display:flex;flex-direction:column;overflow:hidden;min-height:0;">
    <div class="tier-area" id="tierAreaPersonagens" style="flex:1;overflow-y:auto;padding:10px 14px;scrollbar-width:thin;scrollbar-color:#444 #111;"></div>
    <div class="bottom-bar">
      <div style="display:flex;flex-direction:column;flex:1;gap:6px;">
        <button class="add-tier-btn" onclick="addTierPersonagens()">+ Adicionar Tier</button>
        <a href="https://x.com/nivinemedia" target="_blank" style="display:block;text-align:center;color:#555;font-size:0.65rem;letter-spacing:2px;font-family:'Nunito',sans-serif;text-decoration:none;transition:color 0.2s;" onmouseover="this.style.color='#FF6B00'" onmouseout="this.style.color='#555'">feito por @nivinemedia</a>
      </div>
      <button class="action-btn btn-reset" onclick="resetPersonagens()">‚Ü∫ Resetar</button>
      <button class="action-btn btn-result" onclick="takeScreenshotPersonagens()">üì∏ Tirar Print</button>
    </div>
  </div>
</div>
</div><!-- end tier content -->

<!-- Kick Chat Panel -->
<div id="chatPanel" style="width:380px;flex-shrink:0;display:flex;flex-direction:column;background:#0F0F0F;border-left:2px solid #2A2A2A;">
  <div style="padding:6px 10px;background:#111;border-bottom:1px solid #2A2A2A;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;">
    <span style="color:#FF6B00;font-family:'Teko',sans-serif;font-size:1rem;letter-spacing:2px;text-transform:uppercase;">üí¨ Chat ‚Äì Minerva</span>
    <button onclick="toggleChat()" id="chatToggleBtn" style="background:none;border:none;color:#555;cursor:pointer;font-size:1rem;padding:2px 4px;" title="Minimizar chat">‚úï</button>
  </div>
  <iframe
    src="https://kick.com/minerva/chatroom"
    style="flex:1;border:none;width:100%;background:#0F0F0F;"
    allowfullscreen>
  </iframe>
</div>

<!-- Chat toggle button (shown when chat is hidden) -->
<button id="chatOpenBtn" onclick="toggleChat()" style="display:none;position:fixed;right:0;top:50%;transform:translateY(-50%);background:#FF6B00;border:none;color:#000;font-family:'Teko',sans-serif;font-size:0.85rem;letter-spacing:1px;padding:12px 6px;cursor:pointer;border-radius:4px 0 0 4px;writing-mode:vertical-rl;z-index:100;">üí¨ CHAT</button>

</div><!-- end main content + chat wrapper -->

<!-- Modal -->
<div class="modal-overlay hidden" id="resultModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">‚úï</button>
    <h2>MINHA TIER LIST</h2>
    <div id="resultContent"></div>
    <div style="display:flex;gap:10px;margin-top:16px;">
      <button class="modal-share-btn" onclick="copyResult()" style="flex:1;">üìã Copiar Resultado</button>
      <button class="modal-share-btn" id="printBtn" onclick="takeScreenshot()" style="flex:1;background:#222;border:2px solid var(--orange);color:var(--orange);">üì∏ Tirar Print</button>
    </div>
  </div>
</div>

<!-- Split Modal -->
<div class="modal-overlay hidden" id="splitModal" style="align-items:flex-start;padding:20px 0;overflow-y:auto;">
  <div style="background:#111;border:1px solid #2A2A2A;border-radius:10px;width:95vw;max-width:1200px;margin:auto;padding:24px 20px 20px;position:relative;">
    <button class="modal-close" onclick="closeSplitModal()" style="position:absolute;top:14px;right:14px;">‚úï</button>
    <!-- Header same style as page header -->
    <div style="text-align:center;margin-bottom:20px;padding-bottom:16px;border-bottom:2px solid #FF6B00;">
      <h2 style="font-family:'Teko',sans-serif;font-size:2rem;color:#FF6B00;letter-spacing:3px;margin:0;text-transform:uppercase;text-shadow:0 0 12px rgba(255,107,0,0.4);">TIER LIST SEPARADA</h2>
      <p style="color:#666;font-size:0.7rem;letter-spacing:2px;margin:4px 0 0;font-family:'Nunito',sans-serif;">OP/ED Naruto Cl√°ssico</p>
    </div>
    <!-- Two columns -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;">
      <!-- OP column -->
      <div>
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
          <div style="flex:1;height:2px;background:linear-gradient(to right,#FF6B00,transparent);"></div>
          <span style="font-family:'Teko',sans-serif;font-size:1.3rem;color:#FF6B00;letter-spacing:3px;">OPENINGS</span>
          <div style="flex:1;height:2px;background:linear-gradient(to left,#FF6B00,transparent);"></div>
        </div>
        <div id="splitOP"></div>
      </div>
      <!-- ED column -->
      <div>
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
          <div style="flex:1;height:2px;background:linear-gradient(to right,#4488FF,transparent);"></div>
          <span style="font-family:'Teko',sans-serif;font-size:1.3rem;color:#4488FF;letter-spacing:3px;">ENDINGS</span>
          <div style="flex:1;height:2px;background:linear-gradient(to left,#4488FF,transparent);"></div>
        </div>
        <div id="splitED"></div>
      </div>
    </div>
    <div style="display:flex;justify-content:center;margin-top:16px;">
      <button onclick="takeSplitScreenshot()" style="background:#222;border:2px solid #6C63FF;color:#6C63FF;padding:10px 28px;border-radius:8px;cursor:pointer;font-family:'Nunito',sans-serif;font-size:0.85rem;font-weight:700;letter-spacing:1px;transition:all 0.2s;" onmouseover="this.style.background='#6C63FF';this.style.color='#000';" onmouseout="this.style.background='#222';this.style.color='#6C63FF';">üì∏ Tirar Print</button>
    </div>
  </div>
</div>

<script>
const end_10 = "img/songs/end_10.jpg";
const end_11 = "img/songs/end_11.jpg";
const end_12 = "img/songs/end_12.jpg";
const end_13 = "img/songs/end_13.jpg";
const end_14 = "img/songs/end_14.jpg";
const end_15 = "img/songs/end_15.jpg";
const op_SBT = "img/songs/op_SBT.jpg";


const end_1 = "img/songs/end_1.jpg";
const end_2 = "img/songs/end_2.jpg";
const end_3 = "img/songs/end_3.jpg";
const end_4 = "img/songs/end_4.jpg";
const end_5 = "img/songs/end_5.jpg";
const end_6 = "img/songs/end_6.jpg";
const end_7 = "img/songs/end_7.jpg";
const end_8 = "img/songs/end_8.jpg";
const end_9 = "img/songs/end_9.jpg";


const op_1 = "img/songs/op_1.jpg";
const op_2 = "img/songs/op_2.jpg";
const op_3 = "img/songs/op_3.jpg";
const op_4 = "img/songs/op_4.jpg";
const op_5 = "img/songs/op_5.jpg";
const op_6 = "img/songs/op_6.jpg";
const op_7 = "img/songs/op_7.jpg";
const op_8 = "img/songs/op_8.jpg";
const op_9 = "img/songs/op_9.jpg";
const op_SBT_new = "img/songs/op_SBT.jpg";

</script>

<script>
// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ







const p_shukaku = "img/chars/shukaku.png";

const p_akamaru = "img/chars/akamaru.png";
const p_anko = "img/chars/anko.png";
const p_asuma = "img/chars/asuma.png";
const p_baki = "img/chars/baki.png";
const p_naruto = "img/chars/naruto.png";
const p_choji = "img/chars/choji.png";
const p_choza = "img/chars/choza.png";
const p_dan = "img/chars/dan.png";
const p_dosu = "img/chars/dosu.png";
const p_ebisu = "img/chars/ebisu.png";
const p_enma = "img/chars/enma.png";
const p_gaara = "img/chars/gaara.png";
const p_gamabunta = "img/chars/gamabunta.png";
const p_gamatatsu = "img/chars/gamatatsu.png";
const p_genma = "img/chars/genma.png";
const p_haku = "img/chars/haku.png";
const p_hanabi = "img/chars/hanabi.png";
const p_hashirama = "img/chars/hashirama.png";
const p_hayate = "img/chars/hayate.png";
const p_hiashi = "img/chars/hiashi.png";
const p_hinata = "img/chars/hinata.png";
const p_hiruzen = "img/chars/hiruzen.png";
const p_hizashi = "img/chars/hizashi.png";
const p_ibiki = "img/chars/ibiki.png";
const p_inari = "img/chars/inari.png";
const p_inoichi = "img/chars/inoichi.png";
const p_ino = "img/chars/ino.png";
const p_iruka = "img/chars/iruka.png";
const p_itachi = "img/chars/itachi.png";
const p_jiraiya = "img/chars/jiraiya.png";
const p_kabuto = "img/chars/kabuto.png";
const p_kakashi = "img/chars/kakashi.png";
const p_kankuro = "img/chars/kankuro.png";
const p_katsuyu = "img/chars/katsuyu.png";
const p_kiba = "img/chars/kiba.png";
const p_kindomaru = "img/chars/kindomaru.png";
const p_kin = "img/chars/kin.png";
const p_kisame = "img/chars/kisame.png";
const p_konohamaru = "img/chars/konohamaru.png";
const p_kurama = "img/chars/kurama.png";
const p_kurenai = "img/chars/kurenai.png";
const p_manda = "img/chars/manda.png";
const p_guy = "img/chars/guy.png";
const p_mizuki = "img/chars/mizuki.png";
const p_moegi = "img/chars/moegi.png";
const p_nawaki = "img/chars/nawaki.png";
const p_neji = "img/chars/neji.png";
const p_orochimaru = "img/chars/orochimaru.png";
const p_pakkun = "img/chars/pakkun.png";
const p_lee = "img/chars/lee.png";
const p_sakon = "img/chars/sakon.png";
const p_sakura = "img/chars/sakura.png";
const p_sasuke = "img/chars/sasuke.png";
const p_shikaku = "img/chars/shikaku.png";
const p_shikamaru = "img/chars/shikamaru.png";
const p_shino = "img/chars/shino.png";
const p_shizune = "img/chars/shizune.png";
const p_tayuya = "img/chars/tayuya.png";
const p_temari = "img/chars/temari.png";
const p_tenten = "img/chars/tenten.png";
const p_tobirama = "img/chars/tobirama.png";
const p_tonton = "img/chars/tonton.png";
const p_tsunade = "img/chars/tsunade.png";
const p_udon = "img/chars/udon.png";
const p_yashamaru = "img/chars/yashamaru.png";
const p_zabuza = "img/chars/zabuza.png";
const p_deidara = "img/chars/deidara.png";
const personagens = [
  { id:'pakkun', name:'Pakkun', thumb: p_pakkun },
  { id:'shizune', name:'Shizune', thumb: p_shizune },
  { id:'shukaku', name:'Shukaku', thumb: p_shukaku },
  { id:'genma', name:'Genma Shiranui', thumb: p_genma },
  { id:'hayate', name:'Hayate Gekk≈ç', thumb: p_hayate },
  { id:'akamaru', name:'Akamaru', thumb: p_akamaru },
  { id:'anko', name:'Anko Mitarashi', thumb: p_anko },
  { id:'asuma', name:'Asuma', thumb: p_asuma },
  { id:'baki', name:'Baki', thumb: p_baki },
  { id:'naruto', name:'Naruto', thumb: p_naruto },
  { id:'choji', name:'Ch≈çji', thumb: p_choji },
  { id:'choza', name:'Ch≈çza Akimichi', thumb: p_choza },
  { id:'dan', name:'Dan Kat≈ç', thumb: p_dan },
  { id:'dosu', name:'Dosu', thumb: p_dosu },
  { id:'ebisu', name:'Ebisu', thumb: p_ebisu },
  { id:'enma', name:'Enma', thumb: p_enma },
  { id:'gaara', name:'Gaara', thumb: p_gaara },
  { id:'gamabunta', name:'Gamabunta', thumb: p_gamabunta },
  { id:'gamatatsu', name:'Gamatatsu', thumb: p_gamatatsu },
  { id:'haku', name:'Haku', thumb: p_haku },
  { id:'hanabi', name:'Hanabi Hy≈´ga', thumb: p_hanabi },
  { id:'hashirama', name:'Hashirama', thumb: p_hashirama },
  { id:'hiashi', name:'Hiashi Hy≈´ga', thumb: p_hiashi },
  { id:'hinata', name:'Hinata', thumb: p_hinata },
  { id:'hiruzen', name:'Hiruzen', thumb: p_hiruzen },
  { id:'hizashi', name:'Hizashi Hy≈´ga', thumb: p_hizashi },
  { id:'ibiki', name:'Ibiki Morino', thumb: p_ibiki },
  { id:'inari', name:'Inari', thumb: p_inari },
  { id:'inoichi', name:'Inoichi', thumb: p_inoichi },
  { id:'ino', name:'Ino', thumb: p_ino },
  { id:'iruka', name:'Iruka', thumb: p_iruka },
  { id:'itachi', name:'Itachi', thumb: p_itachi },
  { id:'jiraiya', name:'Jiraiya', thumb: p_jiraiya },
  { id:'kabuto', name:'Kabuto', thumb: p_kabuto },
  { id:'kakashi', name:'Kakashi', thumb: p_kakashi },
  { id:'kankuro', name:'Kankur≈ç', thumb: p_kankuro },
  { id:'katsuyu', name:'Katsuyu', thumb: p_katsuyu },
  { id:'kiba', name:'Kiba', thumb: p_kiba },
  { id:'kindomaru', name:'Kidomaru', thumb: p_kindomaru },
  { id:'kin', name:'Kin', thumb: p_kin },
  { id:'kisame', name:'Kisame', thumb: p_kisame },
  { id:'konohamaru', name:'Konohamaru', thumb: p_konohamaru },
  { id:'kurama', name:'Kurama', thumb: p_kurama },
  { id:'kurenai', name:'Kurenai', thumb: p_kurenai },
  { id:'manda', name:'Manda', thumb: p_manda },
  { id:'guy', name:'Maito Guy', thumb: p_guy },
  { id:'mizuki', name:'Mizuki', thumb: p_mizuki },
  { id:'moegi', name:'Moegi', thumb: p_moegi },
  { id:'nawaki', name:'Nawaki', thumb: p_nawaki },
  { id:'neji', name:'Neji', thumb: p_neji },
  { id:'orochimaru', name:'Orochimaru', thumb: p_orochimaru },
  { id:'lee', name:'Rock Lee', thumb: p_lee },
  { id:'sakon', name:'Sakon', thumb: p_sakon },
  { id:'sakura', name:'Sakura', thumb: p_sakura },
  { id:'sasuke', name:'Sasuke', thumb: p_sasuke },
  { id:'shikaku', name:'Shikaku Nara', thumb: p_shikaku },
  { id:'shikamaru', name:'Shikamaru', thumb: p_shikamaru },
  { id:'shino', name:'Shino', thumb: p_shino },
  { id:'tayuya', name:'Tayuya', thumb: p_tayuya },
  { id:'temari', name:'Temari', thumb: p_temari },
  { id:'tenten', name:'Tenten', thumb: p_tenten },
  { id:'tobirama', name:'Tobirama', thumb: p_tobirama },
  { id:'tonton', name:'Tonton', thumb: p_tonton },
  { id:'tsunade', name:'Tsunade', thumb: p_tsunade },
  { id:'udon', name:'Udon', thumb: p_udon },
  { id:'yashamaru', name:'Yashamaru', thumb: p_yashamaru },
  { id:'zabuza', name:'Zabuza', thumb: p_zabuza },
  { id:'deidara', name:'Deidara', thumb: p_deidara },
];

const songs = [
  { id:'opSBT', type:'op', badge:'OP SBT', title:'Abertura do SBT', artist:'animes.com', yt:'https://youtu.be/fBMkrYH259g?si=z8T_RkiyIbCE-7AR', audio:'audio/opSBT.mp3', thumb:op_SBT_new, color:'#200020' },
  { id:'op1', type:'op', badge:'OP 1', title:'R‚òÖO‚òÖC‚òÖK‚òÖS', artist:'Hound Dog', yt:'https://youtu.be/4t__wczfpRI?si=p41aDpXOG6t_yo-D', audio:'audio/op1.m4a', thumb:op_1, color:'#3A1500' },
  { id:'ed1', type:'ed', badge:'ED 1', title:'Wind', artist:'Akeboshi', yt:'https://youtu.be/Oyhpwyrq1N0?si=Xs-59a5FsNvFwXum', audio:'audio/ed1.m4a', thumb:end_1, color:'#001030' },
  { id:'op2', type:'op', badge:'OP 2', title:'Haruka Kanata', artist:'Asian Kung-Fu Generation', yt:'https://youtu.be/SRn99oN1p_c?si=LIG0YuGXqVQKVlP0', audio:'audio/op2.m4a', thumb:op_2, color:'#1A2A00' },
  { id:'ed2', type:'ed', badge:'ED 2', title:'Harmonia', artist:'Rythem', yt:'https://youtu.be/VTIK1gBhzXk?si=9cFnFHdQoU7cTlUS', audio:'audio/ed2.m4a', thumb:end_2, color:'#100030' },
  { id:'op3', type:'op', badge:'OP 3', title:'Kanashimi Wo Yasashisa Ni', artist:'Little by Little', yt:'https://youtu.be/XwJEFzsqNoY?si=5MW23TsOqwaaIE9i', audio:'audio/op3.m4a', thumb:op_3, color:'#00152A' },
  { id:'ed3', type:'ed', badge:'ED 3', title:'Viva‚òÖRock Japanese Side', artist:'Orange Range', yt:'https://youtu.be/pZaRs2bvy4U?si=K8srPf3Gq7Pe62Br', audio:'audio/ed3.m4a', thumb:end_3, color:'#200010' },
  { id:'op4', type:'op', badge:'OP 4', title:'GO!!!', artist:'FLOW', yt:'https://youtu.be/xjBTNbEXbAA?si=uuROQkl-zljmZ9Oj', audio:'audio/op4.m4a', thumb:op_4, color:'#2A0030' },
  { id:'ed4', type:'ed', badge:'ED 4', title:'Alive', artist:'Raiko', yt:'https://youtu.be/kGGgOb61LP0?si=nCWOCs9lh5q3Mf4M', audio:'audio/ed4.m4a', thumb:end_4, color:'#0A0A00' },
  { id:'op5', type:'op', badge:'OP 5', title:'Seishun Kyousoukyoku', artist:'Sambomaster', yt:'https://youtu.be/lilv4MvBY6E?si=PGc9R-PvNSYL6arN', audio:'audio/op5.m4a', thumb:op_5, color:'#1A1500' },
  { id:'ed5', type:'ed', badge:'ED 5', title:'Ima Made Nando Mo', artist:'Mass Missile', yt:'https://youtu.be/ZKd5C6w7UvA?si=4FF3fTp15goKqXtR', audio:'audio/ed5.mp3', thumb:end_5, color:'#001A10' },
  { id:'op6', type:'op', badge:'OP 6', title:'No Boy, No Cry', artist:'Stance Punks', yt:'https://youtu.be/pWyoHrMzAZQ?si=zopwo7bOcQqTxTYJ', audio:'audio/op6.mp3', thumb:op_6, color:'#002020' },
  { id:'ed6', type:'ed', badge:'ED 6', title:'Ryuusei', artist:'TiA', yt:'https://youtu.be/5z5-Ly_VbXk?si=zzKgLzHm3o8Z5dAa', audio:'audio/ed6.mp3', thumb:end_6, color:'#1A0010' },
  { id:'op7', type:'op', badge:'OP 7', title:'Namikaze Satellite', artist:'Snowkel', yt:'https://youtu.be/pY15k20Hqq0?si=6JYrHrtoJgRtLqMd', audio:'audio/op7.mp3', thumb:op_7, color:'#001A30' },
  { id:'ed7', type:'ed', badge:'ED 7', title:'Mountain A Go Go Two', artist:'Captain Straydum', yt:'https://youtu.be/_kjd_3viXu0?si=3hHIheVcLWIMO77K', audio:'audio/ed7.mp3', thumb:end_7, color:'#0A1A00' },
  { id:'op8', type:'op', badge:'OP 8', title:'Re:member', artist:'FLOW', yt:'https://youtu.be/yB2g22359Fg?si=RegNevwC9mfaBQQT', audio:'audio/op8.mp3', thumb:op_8, color:'#1A0020' },
  { id:'ed8', type:'ed', badge:'ED 8', title:'Hajimete Kimi To Shabetta', artist:'GaGaalinG', yt:'https://youtu.be/s2rCblHEYZs?si=6YleOUIdPpYOGRzk', audio:'audio/ed8.mp3', thumb:end_8, color:'#001510' },
  { id:'op9', type:'op', badge:'OP 9', title:'Yura Yura', artist:'Hearts Grow', yt:'https://youtu.be/-m8kR0FQ7Wk?si=iF9ehf9gW8oUme9B', audio:'audio/op9.mp3', thumb:op_9, color:'#2A1A00' },
  { id:'ed9', type:'ed', badge:'ED 9', title:'Lost Words', artist:'No Regret Life', yt:'https://youtu.be/7PG4N8tL6Pw?si=BnEeRNW3x_WXRsAn', audio:'audio/ed9.mp3', thumb:end_9, color:'#0F0020' },
  { id:'ed10', type:'ed', badge:'ED 10', title:'Speed', artist:'Analog Fish', yt:'https://youtu.be/A7pi4-Et5lY?si=rRVdH1PzdvuZiubZ', audio:'audio/ed10.mp3', thumb:end_10, color:'#0A0A1A' },
  { id:'ed11', type:'ed', badge:'ED 11', title:'Soba Ni Iru Kara', artist:'', yt:'https://youtu.be/b5DOukHM3WE?si=oIifOuLcdvAGy6MF', audio:'audio/ed11.mp3', thumb:end_11, color:'#1A0A00' },
  { id:'ed12', type:'ed', badge:'ED 12', title:'Parade', artist:'', yt:'https://youtu.be/xfI6B1Auh-k?si=xHRdTg0KmVcio5ET', audio:'audio/ed12.mp3', thumb:end_12, color:'#1A001A' },
  { id:'ed13', type:'ed', badge:'ED 13', title:'Yellow Moon', artist:'', yt:'https://youtu.be/xPNyvbkrFbY?si=yBTyu_dH6mMB6dxn', audio:'audio/ed13.mp3', thumb:end_13, color:'#1A1000' },
  { id:'ed14', type:'ed', badge:'ED 14', title:'Pinocchio', artist:'', yt:'https://youtu.be/2i0a9nPQLW8?si=EZRp6UcRr1aYVv8I', audio:'audio/ed14.mp3', thumb:end_14, color:'#001010' },
  { id:'ed15', type:'ed', badge:'ED 15', title:'Scenario', artist:'', yt:'https://youtu.be/j65Koam6avI?si=m3JVadNXEWfuxW_C', audio:'audio/ed15.mp3', thumb:end_15, color:'#100010' },
];

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let tiers = [
  { id:'S', label:'S', color:'#FF4444' },
  { id:'A', label:'A', color:'#FF8C00' },
  { id:'B', label:'B', color:'#FFD700' },
  { id:'C', label:'C', color:'#44CC44' },
  { id:'D', label:'D', color:'#4488FF' },
  { id:'F', label:'F', color:'#AA44FF' },
];
let tierSongs = {}; // tierId -> [songId]
let inSidebar = []; // song ids still in sidebar
let customTierCount = 0;
let dragSongId = null;
let dragFromTier = null; // null = sidebar

function init() {
  tiers.forEach(t => { if (!tierSongs[t.id]) tierSongs[t.id] = []; });
  inSidebar = songs.map(s => s.id);
  renderSidebar();
  renderTiers();
}

// ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderSidebar(filter='all') {
  const list = document.getElementById('sidebarList');
  const visible = songs.filter(s => inSidebar.includes(s.id) && (filter==='all' || s.type===filter));
  list.innerHTML = visible.map(s => cardHTML(s)).join('');
  // Also show hidden ones as placeholders
  list.querySelectorAll('.music-card').forEach(el => {
    el.addEventListener('dragstart', e => {
      dragSongId = el.dataset.id;
      dragFromTier = null;
      el.classList.add('dragging');
    });
    el.addEventListener('dragend', e => el.classList.remove('dragging'));
  });
}

function cardHTML(s) {
  const thumbInner = s.thumb
    ? `<img src="${s.thumb}" alt="${s.title}" loading="lazy">`
    : `<div class="card-thumb-placeholder" style="background:linear-gradient(135deg,${s.color},#0A0A0A);">üç•</div>`;
  return `<div class="music-card" draggable="true" data-id="${s.id}">
    <div class="card-thumb" style="cursor:pointer;" onclick="audioPlay('${s.id}')">
      ${thumbInner}
      <span class="card-badge ${s.type}">${s.badge}</span>
      <div class="card-thumb-actions">
        <button class="card-play-btn" data-id="${s.id}" onclick="event.stopPropagation(); audioPlay('${s.id}')" title="Ouvir">‚ñ∂</button>
        <button class="card-yt-btn" onclick="event.stopPropagation(); openYTPopup('${s.yt}')" title="Abrir no YouTube">YT</button>
      </div>
    </div>
    <div class="card-info">
      <div class="card-title">${s.title}</div>
      ${s.artist ? `<div class="card-artist">${s.artist}</div>` : ''}
    </div>
  </div>`;
}

function filterCards(f, btn) {
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderSidebar(f);
}

// ‚îÄ‚îÄ TIERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderTiers() {
  const area = document.getElementById('tierArea');
  area.innerHTML = tiers.map(t => tierRowHTML(t)).join('');
  area.querySelectorAll('.tier-row').forEach(row => {
    const tid = row.dataset.tid;
    row.addEventListener('dragover', e => { e.preventDefault(); row.classList.add('drag-over'); });
    row.addEventListener('dragleave', () => row.classList.remove('drag-over'));
    row.addEventListener('drop', e => { e.preventDefault(); row.classList.remove('drag-over'); dropOnTier(tid); });
  });
  // Tier items drag
  area.querySelectorAll('.tier-item').forEach(el => {
    el.draggable = true;
    el.addEventListener('dragstart', e => {
      dragSongId = el.dataset.id;
      dragFromTier = el.dataset.tier;
      el.classList.add('dragging');
    });
    el.addEventListener('dragend', e => el.classList.remove('dragging'));

  });
}

function tierRowHTML(t) {
  const items = (tierSongs[t.id] || []).map(sid => {
    const s = songs.find(x => x.id === sid);
    if (!s) return '';
    const inner = s.thumb
      ? `<img src="${s.thumb}" alt="${s.title}">`
      : `<div class="tier-item-placeholder" style="background:linear-gradient(135deg,${s.color},#050505)">${s.badge}</div>`;
    return `<div class="tier-item" data-id="${s.id}" data-tier="${t.id}" title="${s.title}">
      ${inner}
      <span class="tier-item-badge ${s.type}">${s.badge}</span>
      <div class="tier-item-overlay" onclick="event.stopPropagation(); audioPlay('${s.id}')">‚ñ∂</div>
      <button class="tier-item-remove" onclick="event.stopPropagation(); returnToSidebar('${s.id}','${t.id}')" title="Remover da tier">‚Ü©</button>
      <div class="tier-item-tooltip">${s.badge}: ${s.title}</div>
    </div>`;
  }).join('');

  const placeholder = (tierSongs[t.id] || []).length === 0
    ? '<span class="tier-placeholder">Solte aqui...</span>' : '';

  return `<div class="tier-row" data-tid="${t.id}">
    <div class="tier-label" style="background:${t.color};font-size:${t.label.length <= 2 ? '2rem' : t.label.length <= 5 ? '1.5rem' : t.label.length <= 10 ? '1.1rem' : t.label.length <= 16 ? '0.85rem' : '0.7rem'}" title="Clique para renomear" onclick="renameTier('${t.id}')">${t.label}</div>
    <div class="tier-content">
      ${items}${placeholder}
    </div>
    <div class="tier-controls">
      <button class="tier-btn" title="Mover para cima" onclick="moveTier('${t.id}',-1)">‚ñ≤</button>
      <button class="tier-btn" title="Mover para baixo" onclick="moveTier('${t.id}',1)">‚ñº</button>
      <button class="tier-btn remove" title="Remover tier" onclick="removeTier('${t.id}')">‚úï</button>
    </div>
  </div>`;
}

function dropOnTier(tid) {
  if (!dragSongId) return;
  // Remove from previous location
  if (dragFromTier !== null && dragFromTier !== undefined) {
    tierSongs[dragFromTier] = (tierSongs[dragFromTier] || []).filter(x => x !== dragSongId);
  } else {
    inSidebar = inSidebar.filter(x => x !== dragSongId);
  }
  // Add to tier
  if (!tierSongs[tid]) tierSongs[tid] = [];
  if (!tierSongs[tid].includes(dragSongId)) tierSongs[tid].push(dragSongId);
  dragSongId = null;
  dragFromTier = null;
  renderSidebar(currentFilter());
  renderTiers();
}

function returnToSidebar(sid, tid) {
  tierSongs[tid] = (tierSongs[tid] || []).filter(x => x !== sid);
  if (!inSidebar.includes(sid)) inSidebar.push(sid);
  renderSidebar(currentFilter());
  renderTiers();
}

function currentFilter() {
  const active = document.querySelector('.filter-btn.active');
  return active ? active.textContent.trim().toLowerCase() : 'all';
}

// ‚îÄ‚îÄ TIER MANAGEMENT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function addTier() {
  customTierCount++;
  const colors = ['#FF6699','#00CCCC','#FF9900','#66FF66','#FF66FF','#FFCC00'];
  const labels = ['E','G','H','I','J','K','L','M','N','O','P','Q'];
  const newId = 'custom_' + customTierCount;
  const label = labels[(customTierCount - 1) % labels.length];
  const color = colors[(customTierCount - 1) % colors.length];
  tiers.push({ id: newId, label, color });
  tierSongs[newId] = [];
  renderTiers();
}

function renameTier(tid) {
  const tier = tiers.find(t => t.id === tid);
  if (!tier) return;
  openTierEditor(tier, () => renderTiers());
}

function moveTier(tid, dir) {
  const idx = tiers.findIndex(t => t.id === tid);
  const newIdx = idx + dir;
  if (newIdx < 0 || newIdx >= tiers.length) return;
  [tiers[idx], tiers[newIdx]] = [tiers[newIdx], tiers[idx]];
  renderTiers();
}

function removeTier(tid) {
  const songs_in = tierSongs[tid] || [];
  songs_in.forEach(sid => { if (!inSidebar.includes(sid)) inSidebar.push(sid); });
  delete tierSongs[tid];
  tiers = tiers.filter(t => t.id !== tid);
  renderSidebar(currentFilter());
  renderTiers();
}

function resetAll() {
  if (!confirm('Resetar a tier list? Todas as m√∫sicas voltar√£o para a lista.')) return;
  tiers.forEach(t => { tierSongs[t.id] = []; });
  inSidebar = songs.map(s => s.id);
  renderSidebar(currentFilter());
  renderTiers();
}

// ‚îÄ‚îÄ RESULT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showResult() {
  const content = document.getElementById('resultContent');
  let html = '';
  tiers.forEach(t => {
    const items = (tierSongs[t.id] || []);
    let songsHtml = '';
    if (items.length > 0) {
      items.forEach(sid => {
        const s = songs.find(x => x.id === sid);
        if (!s) return;
        const thumbHtml = s.thumb
          ? '<img src="' + s.thumb + '" style="width:100%;height:100%;object-fit:cover;display:block;">'
          : '<div style="width:100%;height:100%;background:linear-gradient(135deg,' + s.color + ',#050505);display:flex;align-items:center;justify-content:center;font-size:1.4rem;">üç•</div>';
        songsHtml += '<div class="modal-song-card" onclick="openYTPopup(\'' + s.yt + '\')" title="' + s.title + '">'
          + '<div class="modal-song-thumb">' + thumbHtml + '</div>'
          + '<div class="modal-song-name">' + s.title + '</div>'
          + '</div>';
      });
    } else {
      songsHtml = '<span class="modal-empty">Vazia</span>';
    }
    html += '<div class="modal-tier">'
      + '<div class="modal-tier-header" style="background:' + t.color + '">'
      + '<span class="modal-tier-label">' + t.label + '</span>'
      + '<span>' + items.length + ' m√∫sica' + (items.length !== 1 ? 's' : '') + '</span>'
      + '</div>'
      + '<div class="modal-tier-songs">' + songsHtml + '</div>'
      + '</div>';
  });
  const notRanked = inSidebar.length;
  if (notRanked > 0) html += '<p style="text-align:center;color:var(--text-muted);margin-top:12px;font-size:0.8rem">' + notRanked + ' m√∫sica' + (notRanked !== 1 ? 's' : '') + ' n√£o classificada' + (notRanked !== 1 ? 's' : '') + '</p>';
  content.innerHTML = html;
  document.getElementById('resultModal').classList.remove('hidden');
}

function closeModal() {
  document.getElementById('resultModal').classList.add('hidden');
}

function takeScreenshot() {
  const SCALE = 3;
  const CANVAS_W = 1000;

  // Tier area dimensions
  const LABEL_W = 110;
  const ITEM_W = 70;
  const ITEM_H = 50;
  const THUMB_H = 36;
  const ROW_HPAD = 8;
  const ROW_VPAD = 8;
  const GAP = 5;
  const HEADER_H = 80;
  const ROW_GAP = 5;

  function calcRowH(items) {
    if (items.length === 0) return 60;
    const contentW = CANVAS_W - LABEL_W - ROW_HPAD * 2;
    const perRow = Math.max(1, Math.floor((contentW + GAP) / (ITEM_W + GAP)));
    const rows = Math.ceil(items.length / perRow);
    return rows * (ITEM_H + GAP) - GAP + ROW_VPAD * 2;
  }

  function draw(imgCache) {
    let totalH = HEADER_H;
    tiers.forEach(t => { totalH += calcRowH(tierSongs[t.id] || []) + ROW_GAP; });
    totalH += 16; // bottom padding

    const canvas = document.createElement('canvas');
    canvas.width = CANVAS_W * SCALE;
    canvas.height = totalH * SCALE;
    const ctx = canvas.getContext('2d');
    ctx.scale(SCALE, SCALE);

    // ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ
    // Header bg gradient
    const hGrad = ctx.createLinearGradient(0, 0, 0, HEADER_H);
    hGrad.addColorStop(0, '#1A0A00');
    hGrad.addColorStop(1, '#0F0800');
    ctx.fillStyle = hGrad;
    ctx.fillRect(0, 0, CANVAS_W, HEADER_H);
    // Diagonal pattern
    ctx.strokeStyle = 'rgba(255,107,0,0.04)';
    ctx.lineWidth = 0.5;
    for (let x = -HEADER_H; x < CANVAS_W + HEADER_H; x += 28) {
      ctx.beginPath();
      ctx.moveTo(x, 0);
      ctx.lineTo(x + HEADER_H, HEADER_H);
      ctx.stroke();
    }
    // Orange bottom border
    ctx.fillStyle = '#FF6B00';
    ctx.fillRect(0, HEADER_H - 3, CANVAS_W, 3);
    // Title
    ctx.fillStyle = '#FF6B00';
    ctx.font = 'bold 38px "Teko", sans-serif';
    ctx.textAlign = 'center';
    ctx.shadowColor = 'rgba(255,107,0,0.4)';
    ctx.shadowBlur = 12;
    ctx.fillText('TIER LIST: OP/ED NARUTO CL√ÅSSICO', CANVAS_W / 2, 52);
    ctx.shadowBlur = 0;

    // ‚îÄ‚îÄ BG for tier area ‚îÄ‚îÄ
    ctx.fillStyle = '#0F0F0F';
    ctx.fillRect(0, HEADER_H, CANVAS_W, totalH - HEADER_H);

    let y = HEADER_H + ROW_GAP;

    tiers.forEach(t => {
      const items = tierSongs[t.id] || [];
      const rowH = calcRowH(items);
      const contentW = CANVAS_W - LABEL_W - ROW_HPAD * 2;
      const perRow = Math.max(1, Math.floor((contentW + GAP) / (ITEM_W + GAP)));

      // Row background
      ctx.fillStyle = '#1A1A1A';
      ctx.beginPath();
      ctx.roundRect(0, y, CANVAS_W, rowH, 4);
      ctx.fill();
      ctx.strokeStyle = '#2A2A2A';
      ctx.lineWidth = 1;
      ctx.stroke();

      // Label
      ctx.fillStyle = t.color;
      ctx.beginPath();
      ctx.roundRect(0, y, LABEL_W, rowH, [4, 0, 0, 4]);
      ctx.fill();

      ctx.fillStyle = '#000';
      ctx.textAlign = 'center';
      const fs = t.label.length <= 2 ? 36 : t.label.length <= 5 ? 26 : t.label.length <= 10 ? 19 : t.label.length <= 16 ? 14 : 11;
      ctx.font = `bold ${fs}px "Teko", sans-serif`;
      ctx.fillText(t.label, LABEL_W / 2, y + rowH / 2 + fs * 0.35);

      if (items.length === 0) {
        // "Solte aqui..." placeholder
        ctx.fillStyle = '#2A2A2A';
        ctx.font = 'italic 11px "Nunito", sans-serif';
        ctx.textAlign = 'left';
        ctx.fillText('Solte aqui...', LABEL_W + 14, y + rowH / 2 + 4);
      } else {
        items.forEach((sid, i) => {
          const s = songs.find(x => x.id === sid);
          if (!s) return;
          const col = i % perRow;
          const row = Math.floor(i / perRow);
          const cx = LABEL_W + ROW_HPAD + col * (ITEM_W + GAP);
          const cy = y + ROW_VPAD + row * (ITEM_H + GAP);

          // Card bg
          ctx.fillStyle = '#222';
          ctx.beginPath();
          ctx.roundRect(cx, cy, ITEM_W, ITEM_H, 4);
          ctx.fill();
          ctx.strokeStyle = '#333';
          ctx.lineWidth = 0.8;
          ctx.stroke();

          // Thumbnail clipped
          ctx.save();
          ctx.beginPath();
          ctx.roundRect(cx, cy, ITEM_W, THUMB_H, [4, 4, 0, 0]);
          ctx.clip();
          if (imgCache[sid]) {
            const img = imgCache[sid];
            const iw = img.naturalWidth, ih = img.naturalHeight;
            const scale = Math.max(ITEM_W / iw, THUMB_H / ih);
            const sw = ITEM_W / scale, sh = THUMB_H / scale;
            const sx = (iw - sw) / 2, sy = (ih - sh) / 2;
            ctx.drawImage(img, sx, sy, sw, sh, cx, cy, ITEM_W, THUMB_H);
          } else {
            ctx.fillStyle = s.color || '#1A0800';
            ctx.fillRect(cx, cy, ITEM_W, THUMB_H);
            ctx.font = '16px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('üç•', cx + ITEM_W / 2, cy + THUMB_H / 2 + 6);
          }
          ctx.restore();

          // Badge (OP or ED only)
          ctx.fillStyle = s.type === 'op' ? '#FF6B00' : '#4488FF';
          ctx.beginPath();
          ctx.roundRect(cx + 2, cy + 2, 22, 11, 2);
          ctx.fill();
          ctx.fillStyle = s.type === 'op' ? '#000' : '#fff';
          ctx.font = 'bold 7px "Nunito", sans-serif';
          ctx.textAlign = 'center';
          ctx.fillText(s.type === 'op' ? 'OP' : 'ED', cx + 13, cy + 11);

          // Song name
          ctx.fillStyle = '#E0E0E0';
          ctx.font = 'bold 7.5px "Nunito", sans-serif';
          ctx.textAlign = 'center';
          const maxTW = ITEM_W - 6;
          let name = s.title;
          while (ctx.measureText(name).width > maxTW && name.length > 3) name = name.slice(0, -1);
          if (name !== s.title) name += '‚Ä¶';
          ctx.fillText(name, cx + ITEM_W / 2, cy + ITEM_H - 4);
        });
      }

      y += rowH + ROW_GAP;
    });

    // Download
    canvas.toBlob(blob => {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'naruto-tierlist.png';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      setTimeout(() => URL.revokeObjectURL(url), 1000);
    }, 'image/png');
  }

  const allSids = tiers.flatMap(t => tierSongs[t.id] || []);
  const songsNeeded = allSids.map(sid => songs.find(x => x.id === sid)).filter(s => s && s.thumb);
  if (songsNeeded.length === 0) { draw({}); return; }

  const imgCache = {};
  let loaded = 0;
  songsNeeded.forEach(s => {
    const img = new Image();
    img.onload = () => { imgCache[s.id] = img; loaded++; if (loaded >= songsNeeded.length) draw(imgCache); };
    img.onerror = () => { loaded++; if (loaded >= songsNeeded.length) draw(imgCache); };
    img.src = s.thumb;
  });
}

function copyResult() {
  let text = 'üç• NARUTO ‚Äì TIERLIST\n\n';
  tiers.forEach(t => {
    const items = (tierSongs[t.id] || []);
    if (items.length > 0) {
      text += `[${t.label}] `;
      text += items.map(sid => { const s = songs.find(x => x.id === sid); return s ? s.title : sid; }).join(' | ');
      text += '\n';
    }
  });
  navigator.clipboard.writeText(text).then(() => alert('Copiado! üç•'));
}

document.getElementById('resultModal').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});

// ‚îÄ‚îÄ AUDIO PLAYER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let currentSongIdx = -1;
const audioEl = new Audio();
audioEl.addEventListener('ended', () => audioSkip(1));

function audioPlay(songId) {
  const s = songs.find(x => x.id === songId);
  if (!s || !s.audio) return;

  // If same song is playing, toggle pause/resume
  if (songs[currentSongIdx] && songs[currentSongIdx].id === songId && audioEl.src.includes(s.audio)) {
    if (audioEl.paused) {
      audioEl.play();
      document.getElementById('audioPlayPause').textContent = '‚è∏';
      updatePlayBtns(songId);
    } else {
      audioEl.pause();
      document.getElementById('audioPlayPause').textContent = '‚ñ∂';
      updatePlayBtns(null);
    }
    return;
  }

  currentSongIdx = songs.indexOf(s);
  audioEl.src = s.audio;
  audioEl.volume = document.getElementById('audioVol').value / 100;
  audioEl.play();

  document.getElementById('audioBar').style.display = 'flex';
  document.getElementById('audioTitle').textContent = s.title;
  document.getElementById('audioArtist').textContent = s.artist || s.badge;
  document.getElementById('audioThumb').innerHTML = s.thumb
    ? `<img src="${s.thumb}" style="width:100%;height:100%;object-fit:cover;">` : 'üç•';
  document.getElementById('audioPlayPause').textContent = '‚è∏';
  updatePlayBtns(songId);
}

function updatePlayBtns(activeSongId) {
  document.querySelectorAll('.card-play-btn').forEach(btn => {
    if (btn.dataset.id === activeSongId && !audioEl.paused) {
      btn.textContent = '‚è∏'; btn.style.background = '#FF6B00'; btn.style.color = '#000';
    } else {
      btn.textContent = '‚ñ∂'; btn.style.background = 'rgba(0,0,0,0.7)'; btn.style.color = '#fff';
    }
  });
}

function audioToggle() {
  if (audioEl.paused) {
    audioEl.play();
    document.getElementById('audioPlayPause').textContent = '‚è∏';
    if (currentSongIdx >= 0) updatePlayBtns(songs[currentSongIdx].id);
  } else {
    audioEl.pause();
    document.getElementById('audioPlayPause').textContent = '‚ñ∂';
    updatePlayBtns(null);
  }
}

function audioSkip(dir) {
  if (currentSongIdx < 0) return;
  audioPlay(songs[(currentSongIdx + dir + songs.length) % songs.length].id);
}

function audioStop() {
  audioEl.pause();
  audioEl.src = '';
  document.getElementById('audioBar').style.display = 'none';
  currentSongIdx = -1;
  updatePlayBtns(null);
}

function audioSetVol(v) {
  audioEl.volume = v / 100;
}

// ‚îÄ‚îÄ SPLIT MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildSplitContent(type, containerId) {
  const container = document.getElementById(containerId);
  let html = '';
  tiers.forEach(t => {
    const items = (tierSongs[t.id] || []).filter(sid => {
      const s = songs.find(x => x.id === sid);
      return s && s.type === type;
    });

    // Label font size same logic as main page
    const lbl = t.label;
    const fs = lbl.length <= 2 ? '1.8rem' : lbl.length <= 5 ? '1.3rem' : lbl.length <= 10 ? '1rem' : lbl.length <= 16 ? '0.8rem' : '0.65rem';

    let itemsHtml = '';
    if (items.length > 0) {
      items.forEach(sid => {
        const s = songs.find(x => x.id === sid);
        if (!s) return;
        const thumbHtml = s.thumb
          ? '<img src="' + s.thumb + '" style="width:100%;height:100%;object-fit:cover;display:block;pointer-events:none;">'
          : '<div style="width:100%;height:100%;background:' + s.color + ';display:flex;align-items:center;justify-content:center;font-size:1.2rem;">üç•</div>';
        const badgeColor = s.type === 'op' ? '#FF6B00' : '#4488FF';
        const badgeTextColor = s.type === 'op' ? '#000' : '#fff';
        itemsHtml += `<div style="display:flex;flex-direction:column;align-items:center;flex-shrink:0;"><div title="${s.title}" onclick=\"openYTPopup('${s.yt}')\"
          style="width:68px;height:48px;border-radius:4px;overflow:hidden;position:relative;cursor:pointer;border:1px solid #333;flex-shrink:0;transition:all 0.15s;"
          onmouseover="this.style.transform='scale(1.07)';this.style.borderColor='#fff';"
          onmouseout="this.style.transform='scale(1)';this.style.borderColor='#333';">`
          + thumbHtml
          + `<div style="position:absolute;top:3px;left:3px;background:${badgeColor};color:${badgeTextColor};font-size:6.5px;font-weight:700;padding:1px 3px;border-radius:2px;font-family:Nunito,sans-serif;letter-spacing:0.3px;">${s.badge}</div>`
          + `</div><div style="width:68px;font-size:9px;font-weight:700;color:#ccc;text-align:center;margin-top:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-family:Nunito,sans-serif;">${s.title}</div></div>`;
      });
    } else {
      itemsHtml = '<span style="color:#333;font-size:0.75rem;font-style:italic;letter-spacing:1px;">Vazia</span>';
    }

    html += '<div style="display:flex;align-items:stretch;margin-bottom:5px;border:1px solid #2A2A2A;border-radius:4px;overflow:hidden;min-height:60px;background:#1A1A1A;">'
      + '<div style="width:80px;min-width:80px;display:flex;align-items:center;justify-content:center;text-align:center;font-family:Teko,sans-serif;font-size:' + fs + ';letter-spacing:1px;color:#000;background:' + t.color + ';padding:6px;word-break:break-word;line-height:1.2;flex-shrink:0;">' + lbl + '</div>'
      + '<div style="flex:1;display:flex;flex-wrap:wrap;align-items:flex-start;gap:6px;padding:8px 10px;min-height:60px;">' + itemsHtml + '</div>'
      + '</div>';
  });

  const notRanked = songs.filter(s => s.type === type && inSidebar.includes(s.id)).length;
  if (notRanked > 0) html += '<p style="text-align:center;color:#444;font-size:0.75rem;margin-top:8px;font-family:Nunito,sans-serif;">' + notRanked + ' m√∫sica' + (notRanked !== 1 ? 's' : '') + ' n√£o classificada' + (notRanked !== 1 ? 's' : '') + '</p>';

  container.innerHTML = html;
}

function showSplit() {
  buildSplitContent('op', 'splitOP');
  buildSplitContent('ed', 'splitED');
  document.getElementById('splitModal').classList.remove('hidden');
}

function closeSplitModal() {
  document.getElementById('splitModal').classList.add('hidden');
}

document.getElementById('splitModal').addEventListener('click', function(e) {
  if (e.target === this) closeSplitModal();
});


function takeSplitScreenshot() {
  const SCALE = 3;
  const TOTAL_W = 1400;
  const COL_W = (TOTAL_W - 60) / 2;  // two columns with gap
  const GAP_COLS = 30;
  const LABEL_W = 80;
  const ITEM_W = 68;
  const ITEM_H = 48;
  const THUMB_H = 35;
  const NAME_H = 14;
  const CARD_H = ITEM_H + NAME_H + 4;
  const ROW_HPAD = 8;
  const ROW_VPAD = 8;
  const GAP = 6;
  const HEADER_H = 90;
  const COL_TITLE_H = 36;
  const ROW_GAP = 5;
  const PAD = 16;

  function calcColRowH(items) {
    if (items.length === 0) return 50;
    const contentW = COL_W - LABEL_W - ROW_HPAD * 2;
    const perRow = Math.max(1, Math.floor((contentW + GAP) / (ITEM_W + GAP)));
    const rows = Math.ceil(items.length / perRow);
    return rows * (CARD_H + GAP) - GAP + ROW_VPAD * 2;
  }

  function calcColH(type) {
    let h = COL_TITLE_H + 10;
    tiers.forEach(t => {
      const items = (tierSongs[t.id] || []).filter(sid => { const s = songs.find(x=>x.id===sid); return s && s.type===type; });
      h += calcColRowH(items) + ROW_GAP;
    });
    return h;
  }

  function draw(imgCache) {
    const opH = calcColH('op');
    const edH = calcColH('ed');
    const colH = Math.max(opH, edH);
    const totalH = HEADER_H + PAD + colH + PAD + 24;

    const canvas = document.createElement('canvas');
    canvas.width = TOTAL_W * SCALE;
    canvas.height = totalH * SCALE;
    const ctx = canvas.getContext('2d');
    ctx.scale(SCALE, SCALE);

    // ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ
    const hGrad = ctx.createLinearGradient(0, 0, 0, HEADER_H);
    hGrad.addColorStop(0, '#1A0A00'); hGrad.addColorStop(1, '#0F0800');
    ctx.fillStyle = hGrad;
    ctx.fillRect(0, 0, TOTAL_W, HEADER_H);
    ctx.strokeStyle = 'rgba(255,107,0,0.04)'; ctx.lineWidth = 0.5;
    for (let x = -HEADER_H; x < TOTAL_W + HEADER_H; x += 28) {
      ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x + HEADER_H, HEADER_H); ctx.stroke();
    }
    ctx.fillStyle = '#FF6B00';
    ctx.fillRect(0, HEADER_H - 3, TOTAL_W, 3);
    ctx.fillStyle = '#FF6B00';
    ctx.font = 'bold 42px "Teko", sans-serif';
    ctx.textAlign = 'center';
    ctx.shadowColor = 'rgba(255,107,0,0.4)'; ctx.shadowBlur = 12;
    ctx.fillText('TIER LIST SEPARADA ‚Äî OP/ED NARUTO CL√ÅSSICO', TOTAL_W / 2, 52);
    ctx.shadowBlur = 0;
    ctx.fillStyle = '#666';
    ctx.font = '14px "Nunito", sans-serif';
    ctx.fillText('OP / ED NARUTO CL√ÅSSICO', TOTAL_W / 2, 74);

    // ‚îÄ‚îÄ BG ‚îÄ‚îÄ
    ctx.fillStyle = '#111';
    ctx.fillRect(0, HEADER_H, TOTAL_W, totalH - HEADER_H);

    function drawColumn(type, colX, accentColor) {
      let y = HEADER_H + PAD;

      // Column title
      ctx.fillStyle = accentColor;
      ctx.font = 'bold 22px "Teko", sans-serif';
      ctx.textAlign = 'center';
      ctx.shadowColor = accentColor; ctx.shadowBlur = 8;
      ctx.fillText(type === 'op' ? 'OPENINGS' : 'ENDINGS', colX + COL_W / 2, y + 22);
      ctx.shadowBlur = 0;
      // underline
      ctx.fillStyle = accentColor;
      ctx.fillRect(colX + 20, y + 28, COL_W - 40, 2);
      y += COL_TITLE_H + 10;

      tiers.forEach(t => {
        const items = (tierSongs[t.id] || []).filter(sid => { const s = songs.find(x=>x.id===sid); return s && s.type===type; });
        const rowH = calcColRowH(items);
        const contentW = COL_W - LABEL_W - ROW_HPAD * 2;
        const perRow = Math.max(1, Math.floor((contentW + GAP) / (ITEM_W + GAP)));

        // Row bg
        ctx.fillStyle = '#1A1A1A';
        ctx.beginPath(); ctx.roundRect(colX, y, COL_W, rowH, 4); ctx.fill();
        ctx.strokeStyle = '#2A2A2A'; ctx.lineWidth = 1; ctx.stroke();

        // Label
        ctx.fillStyle = t.color;
        ctx.beginPath(); ctx.roundRect(colX, y, LABEL_W, rowH, [4,0,0,4]); ctx.fill();
        ctx.fillStyle = '#000';
        ctx.textAlign = 'center';
        const fs = t.label.length<=2?28:t.label.length<=5?20:t.label.length<=10?15:t.label.length<=16?11:9;
        ctx.font = `bold ${fs}px "Teko", sans-serif`;
        ctx.fillText(t.label, colX + LABEL_W/2, y + rowH/2 + fs*0.35);

        if (items.length === 0) {
          ctx.fillStyle = '#333'; ctx.font = 'italic 10px "Nunito", sans-serif'; ctx.textAlign = 'left';
          ctx.fillText('Vazia', colX + LABEL_W + 12, y + rowH/2 + 4);
        } else {
          items.forEach((sid, i) => {
            const s = songs.find(x=>x.id===sid); if (!s) return;
            const col = i % perRow, row = Math.floor(i / perRow);
            const cx = colX + LABEL_W + ROW_HPAD + col * (ITEM_W + GAP);
            const cy = y + ROW_VPAD + row * (CARD_H + GAP);

            // Thumb clip
            ctx.save();
            ctx.beginPath(); ctx.roundRect(cx, cy, ITEM_W, THUMB_H, 3); ctx.clip();
            if (imgCache[sid]) {
              const img = imgCache[sid];
              const iw = img.naturalWidth, ih = img.naturalHeight;
              const sc = Math.max(ITEM_W/iw, THUMB_H/ih);
              const sw = ITEM_W/sc, sh = THUMB_H/sc;
              ctx.drawImage(img, (iw-sw)/2, (ih-sh)/2, sw, sh, cx, cy, ITEM_W, THUMB_H);
            } else {
              ctx.fillStyle = s.color||'#1A0800'; ctx.fillRect(cx, cy, ITEM_W, THUMB_H);
            }
            ctx.restore();

            // Badge (OP or ED only)
          ctx.fillStyle = s.type === 'op' ? '#FF6B00' : '#4488FF';
          ctx.beginPath();
          ctx.roundRect(cx + 2, cy + 2, 22, 11, 2);
          ctx.fill();
          ctx.fillStyle = s.type === 'op' ? '#000' : '#fff';
          ctx.font = 'bold 7px "Nunito", sans-serif';
          ctx.textAlign = 'center';
          ctx.fillText(s.type === 'op' ? 'OP' : 'ED', cx + 13, cy + 11);

            // Title below thumb
            ctx.fillStyle = '#CCC'; ctx.font = 'bold 8px "Nunito", sans-serif'; ctx.textAlign = 'center';
            let name = s.title;
            const maxW = ITEM_W - 4;
            while (ctx.measureText(name).width > maxW && name.length > 2) name = name.slice(0,-1);
            if (name !== s.title) name += '‚Ä¶';
            ctx.fillText(name, cx + ITEM_W/2, cy + THUMB_H + 10);
          });
        }
        y += rowH + ROW_GAP;
      });
    }

    drawColumn('op', PAD, '#FF6B00');
    drawColumn('ed', PAD + COL_W + GAP_COLS, '#4488FF');

    // Credit
    ctx.fillStyle = '#555'; ctx.font = '11px "Nunito", sans-serif'; ctx.textAlign = 'center';
    ctx.fillText('feito por @nivinemedia', TOTAL_W/2, totalH - 8);

    canvas.toBlob(blob => {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'naruto-tierlist-separada.png';
      document.body.appendChild(a); a.click();
      document.body.removeChild(a);
      setTimeout(() => URL.revokeObjectURL(url), 1000);
    }, 'image/png');
  }

  const allSids = [...new Set(tiers.flatMap(t => tierSongs[t.id]||[]))];
  const songsNeeded = allSids.map(sid => songs.find(x=>x.id===sid)).filter(s=>s&&s.thumb);
  if (songsNeeded.length === 0) { draw({}); return; }
  const imgCache = {};
  let loaded = 0;
  songsNeeded.forEach(s => {
    const img = new Image();
    img.onload = () => { imgCache[s.id]=img; loaded++; if(loaded>=songsNeeded.length) draw(imgCache); };
    img.onerror = () => { loaded++; if(loaded>=songsNeeded.length) draw(imgCache); };
    img.src = s.thumb;
  });
}


// ‚îÄ‚îÄ TAB SWITCHING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchTab(tab) {
  const isMusicas = tab === 'musicas';
  document.getElementById('layoutMusicas').style.display = isMusicas ? 'flex' : 'none';
  document.getElementById('layoutPersonagens').style.display = isMusicas ? 'none' : 'flex';
  const btnM = document.getElementById('tabMusicas');
  const btnP = document.getElementById('tabPersonagens');
  btnM.style.color = isMusicas ? '#FF6B00' : '#444';
  btnM.style.borderBottomColor = isMusicas ? '#FF6B00' : 'transparent';
  btnP.style.color = isMusicas ? '#444' : '#FF6B00';
  btnP.style.borderBottomColor = isMusicas ? 'transparent' : '#FF6B00';
}

// ‚îÄ‚îÄ PERSONAGENS TIER LIST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ


let tiersPersonagens = [
  { id:'ps', label:'S', color:'#FF4444' },
  { id:'pa', label:'A', color:'#FF8C00' },
  { id:'pb', label:'B', color:'#FFD700' },
  { id:'pc', label:'C', color:'#44CC44' },
  { id:'pd', label:'D', color:'#4488FF' },
  { id:'pf', label:'F', color:'#AA44FF' },
];
let tierSongsPersonagens = {};
let inSidebarPersonagens = [];

tiersPersonagens.forEach(t => { tierSongsPersonagens[t.id] = []; });

function renderTiersPersonagens() {
  const area = document.getElementById('tierAreaPersonagens');
  area.innerHTML = tiersPersonagens.map(t => {
    const items = (tierSongsPersonagens[t.id] || []).map(pid => {
      const p = personagens.find(x => x.id === pid);
      if (!p) return '';
      const inner = p.thumb
        ? `<img src="${p.thumb}" alt="${p.name}" style="width:100%;height:100%;object-fit:cover;">`
        : `<div style="width:100%;height:100%;background:#1A0800;display:flex;align-items:center;justify-content:center;font-size:0.6rem;font-weight:700;color:#fff;text-align:center;padding:2px;">${p.name}</div>`;
      return `<div class="tier-item" data-id="${p.id}" data-tier="${t.id}" title="${p.name}" draggable="true">
        ${inner}
        <button class="tier-item-remove" onclick="event.stopPropagation(); returnPersonagemToSidebar('${p.id}','${t.id}')" title="Remover">‚Ü©</button>
        <div class="tier-item-tooltip">${p.name}</div>
      </div>`;
    }).join('');
    const placeholder = (tierSongsPersonagens[t.id]||[]).length === 0
      ? '<span class="tier-placeholder">Solte aqui...</span>' : '';
    const fs = t.label.length<=2?'2rem':t.label.length<=5?'1.5rem':t.label.length<=10?'1.1rem':t.label.length<=16?'0.85rem':'0.7rem';
    return `<div class="tier-row" data-tid="${t.id}">
      <div class="tier-label" style="background:${t.color};font-size:${fs};" title="Clique para renomear" onclick="renameTierPersonagens('${t.id}')">${t.label}</div>
      <div class="tier-content">${items}${placeholder}</div>
      <div class="tier-controls">
        <button class="tier-btn" onclick="moveTierPersonagens('${t.id}',-1)" title="Subir">‚ñ≤</button>
        <button class="tier-btn" onclick="moveTierPersonagens('${t.id}',1)" title="Descer">‚ñº</button>
        <button class="tier-btn remove" onclick="removeTierPersonagens('${t.id}')" title="Remover">‚úï</button>
      </div>
    </div>`;
  }).join('');

  // Re-attach drag events
  area.querySelectorAll('.tier-row').forEach(row => {
    const tid = row.dataset.tid;
    row.addEventListener('dragover', e => { e.preventDefault(); row.classList.add('drag-over'); });
    row.addEventListener('dragleave', () => row.classList.remove('drag-over'));
    row.addEventListener('drop', e => {
      e.preventDefault(); row.classList.remove('drag-over');
      const pid = e.dataTransfer.getData('pid');
      const fromTier = e.dataTransfer.getData('fromTier');
      if (!pid) return;
      if (fromTier) {
        tierSongsPersonagens[fromTier] = tierSongsPersonagens[fromTier].filter(x=>x!==pid);
      } else {
        inSidebarPersonagens = inSidebarPersonagens.filter(x=>x!==pid);
      }
      if (!tierSongsPersonagens[tid].includes(pid)) tierSongsPersonagens[tid].push(pid);
      renderTiersPersonagens();
      renderSidebarPersonagens();
    });
  });

  area.querySelectorAll('.tier-item').forEach(item => {
    item.addEventListener('dragstart', e => {
      e.dataTransfer.setData('pid', item.dataset.id);
      e.dataTransfer.setData('fromTier', item.dataset.tier);
      item.classList.add('dragging');
    });
    item.addEventListener('dragend', () => item.classList.remove('dragging'));
  });
}

function renderSidebarPersonagens() {
  const list = document.getElementById('sidebarPersonagens');
  if (inSidebarPersonagens.length === 0) {
    list.innerHTML = '<span style="color:#333;font-size:0.75rem;font-style:italic;line-height:80px;padding:0 16px;">Todos classificados!</span>';
    return;
  }
  list.innerHTML = inSidebarPersonagens.map(pid => {
    const p = personagens.find(x=>x.id===pid);
    if (!p) return '';
    const thumb = p.thumb
      ? `<img src="${p.thumb}" alt="${p.name}" style="width:100%;height:100%;object-fit:cover;display:block;">`
      : `<div style="width:100%;height:100%;background:#1A0800;display:flex;align-items:center;justify-content:center;font-size:1rem;">üç•</div>`;
    return `<div draggable="true" data-id="${p.id}" style="display:flex;flex-direction:column;align-items:center;gap:2px;cursor:grab;" title="${p.name}">
      <div style="width:100%;aspect-ratio:1;border:1px solid #333;border-radius:4px;overflow:hidden;transition:border-color 0.15s;"
        onmouseover="this.style.borderColor='#FF6B00'" onmouseout="this.style.borderColor='#333'">
        ${thumb}
      </div>
      <span style="font-size:8px;font-weight:700;color:#aaa;font-family:'Nunito',sans-serif;width:100%;text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${p.name}</span>
    </div>`;
  }).join('');

  list.querySelectorAll('[data-id]').forEach(card => {
    card.addEventListener('dragstart', e => {
      e.dataTransfer.setData('pid', card.dataset.id);
      e.dataTransfer.setData('fromTier', '');
      card.style.opacity = '0.4';
    });
    card.addEventListener('dragend', () => card.style.opacity = '1');
  });
}

function returnPersonagemToSidebar(pid, tid) {
  tierSongsPersonagens[tid] = tierSongsPersonagens[tid].filter(x=>x!==pid);
  if (!inSidebarPersonagens.includes(pid)) inSidebarPersonagens.push(pid);
  renderTiersPersonagens();
  renderSidebarPersonagens();
}

function addTierPersonagens() {
  const letters = 'GHIJKLMNOPQRSTUVWXYZ';
  const used = tiersPersonagens.map(t=>t.label);
  const lbl = letters.split('').find(l=>!used.includes(l)) || 'NEW';
  const colors = ['#FF6699','#00CCCC','#FF9900','#9966FF','#33CC33'];
  const color = colors[tiersPersonagens.length % colors.length];
  const id = 'pt_' + Date.now();
  tiersPersonagens.push({ id, label: lbl, color });
  tierSongsPersonagens[id] = [];
  renderTiersPersonagens();
}

function moveTierPersonagens(tid, dir) {
  const i = tiersPersonagens.findIndex(t=>t.id===tid);
  const j = i + dir;
  if (j < 0 || j >= tiersPersonagens.length) return;
  [tiersPersonagens[i], tiersPersonagens[j]] = [tiersPersonagens[j], tiersPersonagens[i]];
  renderTiersPersonagens();
}

function removeTierPersonagens(tid) {
  const songs_in = tierSongsPersonagens[tid] || [];
  songs_in.forEach(pid => { if (!inSidebarPersonagens.includes(pid)) inSidebarPersonagens.push(pid); });
  delete tierSongsPersonagens[tid];
  tiersPersonagens = tiersPersonagens.filter(t=>t.id!==tid);
  renderTiersPersonagens();
  renderSidebarPersonagens();
}

function renameTierPersonagens(tid) {
  const t = tiersPersonagens.find(x=>x.id===tid);
  if (!t) return;
  openTierEditor(t, () => renderTiersPersonagens());
}

function resetPersonagens() {
  if (!confirm('Resetar a tier list de personagens?')) return;
  tiersPersonagens.forEach(t => { tierSongsPersonagens[t.id] = []; });
  inSidebarPersonagens = personagens.map(p=>p.id);
  renderTiersPersonagens();
  renderSidebarPersonagens();
}


inSidebarPersonagens = personagens.map(p => p.id);
renderTiersPersonagens();
renderSidebarPersonagens();
// ‚îÄ‚îÄ Color conversion helpers (HSV-based) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function hexToHsv(hex) {
  let r=parseInt(hex.slice(1,3),16)/255,g=parseInt(hex.slice(3,5),16)/255,b=parseInt(hex.slice(5,7),16)/255;
  const max=Math.max(r,g,b),min=Math.min(r,g,b),d=max-min;
  let h=0,s=max===0?0:d/max,v=max;
  if(d!==0){switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}h/=6;}
  return {h:Math.round(h*360),s:Math.round(s*100),v:Math.round(v*100)};
}
function hsvToHex(h,s,v) {
  s/=100;v/=100;
  const f=n=>{const k=(n+h/60)%6;return Math.round(255*v*(1-s*Math.max(0,Math.min(k,4-k,1)))).toString(16).padStart(2,'0');};
  return '#'+f(5)+f(3)+f(1);
}


// ‚îÄ‚îÄ TIER EDITOR POPUP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openTierEditor(tier, onSave) {
  // Remove any existing popup
  const existing = document.getElementById('tierEditPopup');
  if (existing) existing.remove();

  const popup = document.createElement('div');
  popup.id = 'tierEditPopup';
  popup.className = 'tier-edit-popup';
  popup.innerHTML = `
    <label>NOME DO TIER</label>
    <input type="text" id="tierEditName" value="${tier.label}" maxlength="20" autocomplete="off">
    <label>COR</label>
    <div class="color-picker-wrap">
      <canvas class="color-spectrum" id="colorSpectrum" width="160" height="140"></canvas>
      <input type="range" class="color-hue-slider" id="colorHue" min="0" max="360" value="0">
      <div class="color-preview-row">
        <div class="color-preview-swatch" id="colorSwatch"></div>
        <input type="text" class="color-preview-hex" id="colorHexInput" maxlength="7" placeholder="#FF6B00">
      </div>
    </div>
    <button class="popup-confirm" onclick="confirmTierEdit('${tier.id}')">‚úì Aplicar</button>
  `;

  // Store reference for save
  popup._tier = tier;
  popup._onSave = onSave;

  document.body.appendChild(popup);

  // Position popup near the label that was clicked - use mouse position
  const mx = window._lastMouseX || 200;
  const my = window._lastMouseY || 200;
  const pw = 180, ph = 150;
  let left = mx + 10;
  let top = my - 10;
  if (left + pw > window.innerWidth) left = mx - pw - 10;
  if (top + ph > window.innerHeight) top = window.innerHeight - ph - 10;
  popup.style.left = left + 'px';
  popup.style.top = top + 'px';

  // Focus name input
  setTimeout(() => {
    const inp = document.getElementById('tierEditName');
    if (inp) { inp.focus(); inp.select(); }
  }, 50);

  // Close on outside click
  setTimeout(() => {
    document.addEventListener('mousedown', closeTierEditorOutside);
  }, 100);

  // ‚îÄ‚îÄ Custom Color Picker ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const _hsv = hexToHsv(tier.color);
  let _hue = _hsv.h, _sat = _hsv.s, _val = _hsv.v;

  const spectrum = document.getElementById('colorSpectrum');
  const hueSlider = document.getElementById('colorHue');
  const swatch = document.getElementById('colorSwatch');
  const hexInp = document.getElementById('colorHexInput');

  hueSlider.value = _hue;
  hexInp.value = tier.color;
  swatch.style.background = tier.color;

  function drawSpectrum(h) {
    const ctx2 = spectrum.getContext('2d');
    const W = spectrum.width, H = spectrum.height;
    ctx2.fillStyle = `hsl(${h},100%,50%)`;
    ctx2.fillRect(0,0,W,H);
    const wg = ctx2.createLinearGradient(0,0,W,0);
    wg.addColorStop(0,'#fff'); wg.addColorStop(1,'rgba(255,255,255,0)');
    ctx2.fillStyle = wg; ctx2.fillRect(0,0,W,H);
    const bg = ctx2.createLinearGradient(0,0,0,H);
    bg.addColorStop(0,'rgba(0,0,0,0)'); bg.addColorStop(1,'#000');
    ctx2.fillStyle = bg; ctx2.fillRect(0,0,W,H);
  }

  function updateColor(h, s, v) {
    _hue=h; _sat=s; _val=v;
    const hex = hsvToHex(h, s, v);
    tier.color = hex;
    swatch.style.background = hex;
    hexInp.value = hex;
    onSave();
  }

  drawSpectrum(_hue);

  hueSlider.addEventListener('input', function() {
    _hue = +this.value;
    drawSpectrum(_hue);
    updateColor(_hue, _sat, _val);
  });

  function spectrumPick(e) {
    const rect = spectrum.getBoundingClientRect();
    const x = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
    const y = Math.max(0, Math.min(1, (e.clientY - rect.top) / rect.height));
    // x = saturation (0‚Üí100), y = 1-value (top=bright=100, bottom=dark=0)
    updateColor(_hue, x * 100, (1 - y) * 100);
  }

  let _dragging = false;
  spectrum.addEventListener('mousedown', e => { _dragging=true; e.preventDefault(); spectrumPick(e); });
  document.addEventListener('mousemove', e => { if(_dragging) spectrumPick(e); });
  document.addEventListener('mouseup', () => { _dragging=false; });

  hexInp.addEventListener('change', function() {
    const v = this.value.trim();
    if (/^#[0-9A-Fa-f]{6}$/.test(v)) {
      const hsv = hexToHsv(v);
      _hue=hsv.h; _sat=hsv.s; _val=hsv.v;
      hueSlider.value=_hue;
      drawSpectrum(_hue);
      tier.color=v; swatch.style.background=v; onSave();
    }
  });

}

function closeTierEditorOutside(e) {
  const popup = document.getElementById('tierEditPopup');
  if (popup && !popup.contains(e.target)) {
    popup.remove();
    document.removeEventListener('mousedown', closeTierEditorOutside);
  }
}

function confirmTierEdit(tid) {
  const popup = document.getElementById('tierEditPopup');
  if (!popup) return;
  const name = document.getElementById('tierEditName').value.trim();
  const color = popup._tier.color;
  const tier = popup._tier;
  const onSave = popup._onSave;
  if (name) tier.label = name;
  tier.color = color;
  popup.remove();
  document.removeEventListener('mousedown', closeTierEditorOutside);
  onSave();
}

// Track mouse position for popup placement
document.addEventListener('mousemove', e => { window._lastMouseX = e.clientX; window._lastMouseY = e.clientY; });


function takeScreenshotPersonagens() {
  const SCALE = 3;
  const CANVAS_W = 1000;
  const LABEL_W = 110;
  const ITEM_W = 70;
  const ITEM_H = 70;
  const ROW_HPAD = 8;
  const ROW_VPAD = 8;
  const GAP = 5;
  const HEADER_H = 80;
  const ROW_GAP = 5;

  function calcRowH(items) {
    if (items.length === 0) return 60;
    const contentW = CANVAS_W - LABEL_W - ROW_HPAD * 2;
    const perRow = Math.max(1, Math.floor((contentW + GAP) / (ITEM_W + GAP)));
    const rows = Math.ceil(items.length / perRow);
    return rows * (ITEM_H + GAP) - GAP + ROW_VPAD * 2;
  }

  function draw(imgCache) {
    let totalH = HEADER_H;
    tiersPersonagens.forEach(t => { totalH += calcRowH(tierSongsPersonagens[t.id] || []) + ROW_GAP; });
    totalH += 16;

    const canvas = document.createElement('canvas');
    canvas.width = CANVAS_W * SCALE;
    canvas.height = totalH * SCALE;
    const ctx = canvas.getContext('2d');
    ctx.scale(SCALE, SCALE);

    // Header
    const hGrad = ctx.createLinearGradient(0, 0, 0, HEADER_H);
    hGrad.addColorStop(0, '#1A0A00'); hGrad.addColorStop(1, '#0F0800');
    ctx.fillStyle = hGrad;
    ctx.fillRect(0, 0, CANVAS_W, HEADER_H);
    ctx.strokeStyle = 'rgba(255,107,0,0.04)'; ctx.lineWidth = 0.5;
    for (let x = -HEADER_H; x < CANVAS_W + HEADER_H; x += 28) {
      ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x + HEADER_H, HEADER_H); ctx.stroke();
    }
    ctx.fillStyle = '#FF6B00';
    ctx.fillRect(0, HEADER_H - 3, CANVAS_W, 3);
    ctx.fillStyle = '#FF6B00';
    ctx.font = 'bold 38px "Teko", sans-serif';
    ctx.textAlign = 'center';
    ctx.shadowColor = 'rgba(255,107,0,0.4)'; ctx.shadowBlur = 12;
    ctx.fillText('NARUTO CL√ÅSSICO ‚Äì TIER LIST: PERSONAGENS', CANVAS_W / 2, 52);
    ctx.shadowBlur = 0;

    ctx.fillStyle = '#0F0F0F';
    ctx.fillRect(0, HEADER_H, CANVAS_W, totalH - HEADER_H);

    let y = HEADER_H + ROW_GAP;

    tiersPersonagens.forEach(t => {
      const items = tierSongsPersonagens[t.id] || [];
      const rowH = calcRowH(items);
      const contentW = CANVAS_W - LABEL_W - ROW_HPAD * 2;
      const perRow = Math.max(1, Math.floor((contentW + GAP) / (ITEM_W + GAP)));

      ctx.fillStyle = '#1A1A1A';
      ctx.beginPath(); ctx.roundRect(0, y, CANVAS_W, rowH, 4); ctx.fill();
      ctx.strokeStyle = '#2A2A2A'; ctx.lineWidth = 1; ctx.stroke();

      ctx.fillStyle = t.color;
      ctx.beginPath(); ctx.roundRect(0, y, LABEL_W, rowH, [4,0,0,4]); ctx.fill();
      ctx.fillStyle = '#000';
      ctx.textAlign = 'center';
      const fs = t.label.length<=2?36:t.label.length<=5?26:t.label.length<=10?19:t.label.length<=16?14:11;
      ctx.font = `bold ${fs}px "Teko", sans-serif`;
      ctx.fillText(t.label, LABEL_W/2, y + rowH/2 + fs*0.35);

      if (items.length === 0) {
        ctx.fillStyle = '#2A2A2A'; ctx.font = 'italic 11px "Nunito", sans-serif';
        ctx.textAlign = 'left';
        ctx.fillText('Vazio...', LABEL_W + 14, y + rowH/2 + 4);
      } else {
        items.forEach((pid, i) => {
          const p = personagens.find(x => x.id === pid); if (!p) return;
          const col = i % perRow, row2 = Math.floor(i / perRow);
          const cx = LABEL_W + ROW_HPAD + col * (ITEM_W + GAP);
          const cy = y + ROW_VPAD + row2 * (ITEM_H + GAP);

          ctx.fillStyle = '#222';
          ctx.beginPath(); ctx.roundRect(cx, cy, ITEM_W, ITEM_H, 4); ctx.fill();
          ctx.strokeStyle = '#333'; ctx.lineWidth = 0.8; ctx.stroke();

          ctx.save();
          ctx.beginPath(); ctx.roundRect(cx, cy, ITEM_W, ITEM_H, 4); ctx.clip();
          if (imgCache[pid]) {
            const img = imgCache[pid];
            const iw = img.naturalWidth, ih = img.naturalHeight;
            const scale = Math.max(ITEM_W/iw, ITEM_H/ih);
            const sw = ITEM_W/scale, sh = ITEM_H/scale;
            ctx.drawImage(img, (iw-sw)/2, (ih-sh)/2, sw, sh, cx, cy, ITEM_W, ITEM_H);
          } else {
            ctx.fillStyle = '#1A0800'; ctx.fillRect(cx, cy, ITEM_W, ITEM_H);
          }
          ctx.restore();

          // Name with dark background strip
          ctx.font = 'bold 7.5px "Nunito", sans-serif';
          ctx.textAlign = 'center';
          let name = p.name;
          const maxTW = ITEM_W - 4;
          while (ctx.measureText(name).width > maxTW && name.length > 3) name = name.slice(0,-1);
          if (name !== p.name) name += '‚Ä¶';
          const nameH = 12;
          ctx.fillStyle = 'rgba(0,0,0,0.72)';
          ctx.fillRect(cx, cy + ITEM_H - nameH, ITEM_W, nameH);
          ctx.fillStyle = '#FFFFFF';
          ctx.fillText(name, cx + ITEM_W/2, cy + ITEM_H - 3);
        });
      }
      y += rowH + ROW_GAP;
    });

    // Credit
    ctx.fillStyle = '#444'; ctx.font = '9px "Nunito", sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('feito por @nivinemedia', CANVAS_W/2, totalH - 4);

    canvas.toBlob(blob => {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'naruto-tierlist-personagens.png';
      document.body.appendChild(a); a.click();
      document.body.removeChild(a);
      setTimeout(() => URL.revokeObjectURL(url), 1000);
    }, 'image/png');
  }

  const allPids = tiersPersonagens.flatMap(t => tierSongsPersonagens[t.id] || []);
  const needed = allPids.map(pid => personagens.find(x=>x.id===pid)).filter(p=>p&&p.thumb);
  if (needed.length === 0) { draw({}); return; }
  const imgCache = {};
  let loaded = 0;
  needed.forEach(p => {
    const img = new Image();
    img.onload = () => { imgCache[p.id]=img; loaded++; if(loaded>=needed.length) draw(imgCache); };
    img.onerror = () => { loaded++; if(loaded>=needed.length) draw(imgCache); };
    img.src = p.thumb;
  });
}


function openYTPopup(url) {
  // Convert youtu.be or watch?v= to embed URL
  let videoId = '';
  const shortMatch = url.match(/youtu\.be\/([a-zA-Z0-9_-]+)/);
  const longMatch  = url.match(/[?&]v=([a-zA-Z0-9_-]+)/);
  if (shortMatch) videoId = shortMatch[1];
  else if (longMatch) videoId = longMatch[1];
  if (!videoId) { window.open(url, '_blank'); return; }

  const embedUrl = 'https://www.youtube.com/embed/' + videoId + '?rel=0';
  document.getElementById('ytPopupFrame').src = embedUrl;
  document.getElementById('ytPopupOverlay').classList.add('active');
}

function closeYTPopup(e, force) {
  if (force || (e && e.target === document.getElementById('ytPopupOverlay'))) {
    document.getElementById('ytPopupOverlay').classList.remove('active');
    document.getElementById('ytPopupFrame').src = '';
  }
}

// Close on Escape key
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeYTPopup(null, true); });


function toggleChat() {
  const panel = document.getElementById('chatPanel');
  const openBtn = document.getElementById('chatOpenBtn');
  if (panel.style.display === 'none') {
    panel.style.display = 'flex';
    openBtn.style.display = 'none';
  } else {
    panel.style.display = 'none';
    openBtn.style.display = 'block';
  }
}


init();
</script>


<!-- YouTube Popup -->
<div id="ytPopupOverlay" onclick="closeYTPopup(event)">
  <div id="ytPopupBox">
    <button id="ytPopupClose" onclick="closeYTPopup(null, true)" title="Fechar">‚úï</button>
    <iframe id="ytPopupFrame" src="" allowfullscreen allow="autoplay; encrypted-media; picture-in-picture; fullscreen"></iframe>
  </div>
</div>
</body>
</html>
